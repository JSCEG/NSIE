@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="es">

<head>
    <title>SNIE - Registro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css">
    <link rel="stylesheet" href="~/css/Login.css" />
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            overflow-x: hidden;
            background-color: #e6f5f8;
        }

        .container {
            position: relative;
            z-index: 2;
        }

        .registration_container {
            background: #fff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }

        .form-section {
            border: 1px solid #81c3c9;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background-color: #f8f9fa;
        }

        .custom-file-input~.custom-file-label::after {
            content: "Examinar";
            background-color: #81c3c9;
            color: white;
            border-left: 1px solid #dee2e6;
        }

        .custom-file-input:focus~.custom-file-label {
            box-shadow: 0 0 0 0.2rem rgba(28, 76, 99, 0.25);
            border-color: #81c3c9;
        }

        .barra-carga {
            height: 20px;
            background-color: #f3f3f3;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .barra-carga .progreso {
            height: 100%;
            width: 0%;
            background-color: #81c3c9;
            transition: width 2s ease;
        }

        .step-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #1c4c63;
        }

        .modal-backdrop {
            z-index: 1040 !important;
        }

        .modal-content {
            z-index: 1100 !important;
            background-color: #e6f5f8;
            border: 2px solid #81c3c9;
        }

        video#myVideo {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            z-index: 1;
        }

        .is-invalid {
            border-color: #dc3545;
        }

        .invalid-feedback {
            display: block;
        }
    </style>
</head>

<body>
    <video autoplay muted loop id="myVideo">
        <source src="/video/Login_n.mp4" type="video/mp4">
    </video>

    <div class="container">
        <div class="registration_container">
            <div class="text-center mb-4">
                <img src="/img/lc6.png" style="height: 100px;" alt="Logo SNIE">
                <h3 class="subtitulo mt-3">Registro de Usuario</h3>
            </div>

            <form id="registroForm" class="needs-validation" novalidate method="post" action="#"
                enctype="multipart/form-data">
                <!-- Paso 1 -->
                <div class="form-section">
                    <p class="step-title">Paso 1: Cargar Constancia de Situación Fiscal</p>
                    <div class="form-group">
                        <input type="file" class="form-control-file" id="constanciaFile" required>
                        <small class="form-text text-muted">PDF, máximo 5MB</small>
                    </div>
                    <div id="preloader" style="display:none;">
                        <div class="barra-carga">
                            <div class="progreso" id="barraProgreso"></div>
                        </div>
                        <p class="text-center">Procesando constancia...</p>
                    </div>
                    <div id="datosFiscales" style="display:none;">
                        <div class="alert alert-info">
                            <strong>RFC:</strong> <input type="text" id="rfc" class="form-control"
                                value="SACJ820506BC5"><br />
                            <strong>CURP:</strong> <input type="text" id="curp" class="form-control"
                                value="SACJ820506HDFSLV02"><br />
                            <strong>Nombre:</strong> JAVIER SASSO CELAYA<br />
                            <strong>Domicilio:</strong> LA QUEMADA 3915 DEPTO 304<br />
                            <strong>CP:</strong> 03000<br />
                            <strong>Régimen:</strong> Sueldos y Salarios
                        </div>
                    </div>
                </div>

                <!-- Paso 2 -->
                <div class="form-section">
                    <p class="step-title">Paso 2: Subir Certificados Digitales</p>
                    <div class="form-group">
                        <label>Archivo .cer</label>
                        <input type="file" class="form-control-file" id="certificadoCer" required>
                    </div>
                    <div class="form-group">
                        <label>Archivo .key</label>
                        <input type="file" class="form-control-file" id="llavePrivada" required>
                    </div>
                    <div class="form-group">
                        <label>Contraseña</label>
                        <input type="password" class="form-control" id="password" required>
                        <div class="invalid-feedback">
                            La contraseña debe tener al menos 8 caracteres, incluir una letra, un número y un carácter
                            especial.
                        </div>
                    </div>

                </div>

                <!-- Paso 3 -->
                <div class="form-section">
                    <p class="step-title">Paso 3: Datos de Contacto y Acceso</p>
                    <div class="form-group">
                        <label for="email">Correo Electrónico</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="form-group">
                        <label for="telefono">Teléfono</label>
                        <input type="tel" class="form-control" id="telefono" value="+52" required>
                    </div>
                    <div class="form-group">
                        <label>Contraseña</label>
                        <input type="password" class="form-control" id="password" required>
                        <div class="invalid-feedback">
                            La contraseña debe tener al menos 8 caracteres, una letra, un número y un carácter especial
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Confirmar Contraseña</label>
                        <input type="password" class="form-control" id="confirmPassword" required>
                        <div class="invalid-feedback">
                            Las contraseñas no coinciden
                        </div>
                    </div>
                </div>

                <div class="text-right">
                    <button type="submit" class="btn btn-primary">Completar Registro</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL -->
    <div class="modal fade" id="modalExito" tabindex="-1" role="dialog" aria-labelledby="modalExitoLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">✅ Registro Exitoso</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center">
                    <p>Tu información ha sido registrada exitosamente y fue enviada de manera segura al SAT.</p>
                    <p>Hemos enviado un correo con tu acuse de registro en PDF.</p>
                    <a href="/Constancia Ejemplo/1.-Constancia de Situación Fiscal Javier Sasso Celaya.pdf"
                        class="btn btn-success mt-3" target="_blank">
                        <i class="fas fa-file-pdf"></i> Descargar Acuse
                    </a>
                    <hr />
                    <p><strong>Para acceder al sistema, primero verifica tu cuenta con el enlace que hemos enviado a tu
                            correo electrónico.</strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Entendido</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Al final del body, antes del cierre -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('registroForm');

            if (form) {
                form.addEventListener('submit', function (event) {
                    let valid = true;
                    const requiredFields = ['constanciaFile', 'certificadoCer', 'llavePrivada', 'keyPassword', 'email', 'telefono', 'password', 'confirmPassword'];
                    requiredFields.forEach(id => {
                        const input = document.getElementById(id);
                        if (input && !input.value.trim()) {
                            input.classList.add('is-invalid');
                            valid = false;
                        } else {
                            input.classList.remove('is-invalid');
                        }
                    });

                    const pass = document.getElementById('password');
                    const confirm = document.getElementById('confirmPassword');
                    if (pass && confirm && pass.value !== confirm.value) {
                        confirm.classList.add('is-invalid');
                        valid = false;
                        alert('Las contraseñas no coinciden.');
                    } else {
                        confirm.classList.remove('is-invalid');
                    }

                    if (!valid) {
                        const firstInvalid = form.querySelector('.is-invalid');
                        if (firstInvalid) {
                            firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        return false;
                    } else {
                        event.preventDefault();
                        console.log("Correo enviado a: " + document.getElementById('email').value);
                        $('#modalExito').modal('show'); // Asegúrate de que esta línea esté correctamente indentada
                    }
                });
                const constanciaFile = document.getElementById('constanciaFile');
                if (constanciaFile) {
                    constanciaFile.addEventListener('change', function () {
                        const file = this.files[0];
                        if (file) {
                            if (file.size > 5 * 1024 * 1024) { // 5MB
                                alert('El archivo es demasiado grande. El tamaño máximo es 5MB.');
                                this.value = '';
                                return;
                            }
                            if (!file.type.match('application/pdf')) {
                                alert('Solo se permiten archivos PDF.');
                                this.value = '';
                                return;
                            }

                            // Simular carga de archivo
                            const preloader = document.getElementById('preloader');
                            const datosFiscales = document.getElementById('datosFiscales');
                            const barraProgreso = document.getElementById('barraProgreso');

                            preloader.style.display = 'block';
                            barraProgreso.style.width = '0%';

                            setTimeout(() => {
                                barraProgreso.style.width = '100%';
                                setTimeout(() => {
                                    preloader.style.display = 'none';
                                    datosFiscales.style.display = 'block';
                                }, 500);
                            }, 1000);
                        }
                    });
                }
                const telefono = document.getElementById('telefono');
                if (telefono) {
                    telefono.addEventListener('input', function () {
                        const pattern = /^\+52[0-9]{10}$/;
                        if (!pattern.test(this.value.trim())) {
                            this.classList.add('is-invalid');
                        } else {
                            this.classList.remove('is-invalid');
                        }
                    });
                }

                const rfc = document.getElementById('rfc');
                if (rfc) {
                    rfc.addEventListener('input', function () {
                        const pattern = /^([A-ZÑ&]{3,4})\\d{6}[A-Z0-9]{3}$/;
                        if (!pattern.test(rfc.value.trim().toUpperCase())) {
                            rfc.classList.add('is-invalid');
                        } else {
                            rfc.classList.remove('is-invalid');
                        }
                    });
                }

                const curp = document.getElementById('curp');
                if (curp) {
                    curp.addEventListener('input', function () {
                        const pattern = /^[A-Z]{4}\d{6}[HM][A-Z]{5}[A-Z0-9]{2}$/;
                        if (!pattern.test(curp.value.trim().toUpperCase())) {
                            curp.classList.add('is-invalid');
                        } else {
                            curp.classList.remove('is-invalid');
                        }
                    });
                }

                const password = document.getElementById('password');
                if (password) {
                    password.addEventListener('input', function () {
                        const pattern = new RegExp("^(?=.*[A-Za-z])(?=.*\\d)(?=.*[$!%*#?&])[A-Za-z\\d$!%*#?&]{8,}$");
                        if (!pattern.test(this.value)) {
                            this.classList.add('is-invalid');
                        } else {
                            this.classList.remove('is-invalid');
                        }
                    });
                }




            }
        });

        $('#modalExito').on('hidden.bs.modal', function () {
            const form = document.getElementById('registroForm');
            if (form) {
                form.reset();
            }
            document.getElementById('datosFiscales').style.display = 'none';
        });

    </script>
</body>

</html>
