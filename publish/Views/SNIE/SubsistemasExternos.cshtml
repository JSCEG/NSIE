@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json
@using NSIE.Models
@inject IHttpContextAccessor HttpContextAccessor

@{
    var httpContext = HttpContextAccessor.HttpContext;
    var perfilUsuarioJson = httpContext.Session.GetString("PerfilUsuario");
    var perfilUsuario = JsonConvert.DeserializeObject<PerfilUsuario>(perfilUsuarioJson);
    ViewData["NombreUsuario"] = perfilUsuario.Nombre;
    ViewData["RolUsuario"] = perfilUsuario.Rol;
    ViewData["Title"] = "Subsistemas Externos Integrados";
}

@{
    var header = new HeaderViewModel
    {
        Title = "Subsistemas Externos Integrados",
        IconPath = "subsistemas.png",
        Description = "Visualiza interoperabilidad con subsistemas locales.",
        Section = "Gobernanza y Seguridad",
        ModuleInfo = JsonConvert.SerializeObject(new
        {
            title = "Subsistemas Externos Integrados",
            description = "Sistema de consulta de entidades federativas y privadas integradas al SNIE.",
            functionality = "Permite visualizar el estado de conexión e integración de subsistemas externos.",
            stage = "Inicialización",
            roles = new[] {
                new { icon = "industry", text = "PEMEX: Integración de datos petroleros" },
                new { icon = "bolt", text = "CFE: Sistemas eléctricos" },
                new { icon = "chart-line", text = "CENACE: Control energético" },
                new { icon = "lightbulb", text = "CONUEE: Eficiencia energética" },
                new { icon = "map-marked-alt", text = "Entidades Federativas: Datos locales" },
                new { icon = "city", text = "Municipios: Información municipal" },
                new { icon = "building", text = "Privados: Datos del sector" },
                new { icon = "certificate", text = "CELs: Certificados energéticos" }
            },
            order = new { step = 3, description = "Integración de actores externos (Art. 69)" }
        }),
        LegalDescription = "Gestión de la interoperabilidad con sistemas externos conforme al Art. 69 del Reglamento.",
        Fundamentos = new List<FundamentoLegal> {
            new() { Reference = "Art. 69 Reglamento", Description = "Establece los lineamientos para la integración de subsistemas externos" }
        }
    };
}

@await Html.PartialAsync("_ViewHeader", header)

<div class="container ps-5 pe-5">
    <div class="row">
        <div class="col-md-8">
            <div id="mapaSubsistemas" class="border rounded" style="height: 600px;"></div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Estado de Integración</h5>
                </div>
                <div class="card-body">
                    <div id="estadisticasIntegracion"></div>
                </div>
            </div>
        </div>
    </div>
</div>

@{
    var moduleInfo = new
    {
        title = "Subsistemas Externos Integrados",
        description = "Sistema de consulta de entidades federativas y privadas integradas al SNIE.",
        functionality = "Permite visualizar el estado de conexión e integración de subsistemas externos.",
        stage = "Inicialización",
        roles = new[] {
            new { icon = "building", text = "PEMEX: Integración de datos" },
            new { icon = "bolt", text = "CFE: Reportes energéticos" },
            new { icon = "chart-line", text = "CENACE: Información operativa" },
            new { icon = "map-marked-alt", text = "Entidades Federativas: Datos locales" }
        },
        order = new { step = 3, description = "Integración de actores externos (Art. 69)" }
    };
}


