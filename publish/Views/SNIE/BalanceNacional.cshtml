<!-- BalanceNacional.cshtml - Vista limpia con Sankey y tablas sin cards -->
@model dynamic
@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json
@using NSIE.Models
@inject IHttpContextAccessor HttpContextAccessor

@{
    var httpContext = HttpContextAccessor.HttpContext;
    var perfilUsuarioJson = httpContext.Session.GetString("PerfilUsuario");
    var perfilUsuario = JsonConvert.DeserializeObject<PerfilUsuario>(perfilUsuarioJson);
    ViewData["NombreUsuario"] = perfilUsuario.Nombre;
    ViewData["RolUsuario"] = perfilUsuario.Rol;
    ViewData["IDUsuario"] = perfilUsuario.IdUsuario;
    ViewData["Title"] = "Balance Nacional de Energía 2023";
}

<div class="container-fluid py-4 ps-5 pe-5">
    <!-- Título y Migas de pan -->
    <div class="text-center mb-4">
        <h3 class="fw-bold">
            <img src="~/img/sankey.png" alt="Icono personalizado" class="iconomenu me-2" />@ViewData["Title"]
        </h3>
    </div>
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">Inicio</a></li>
            <li class="breadcrumb-item active">@ViewData["Title"]</li>
        </ol>
    </nav>

    <!-- Indicadores clave -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="p-3 bg-primary text-white rounded shadow-sm">
                <h6 class="mb-1">Independencia Energética</h6>
                <h3 class="fw-bold">0.72</h3>
                <small>↑ 1.11% vs 2022</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="p-3 bg-success text-white rounded shadow-sm">
                <h6 class="mb-1">Intensidad Energética</h6>
                <h3 class="fw-bold">407.99 kJ/$</h3>
                <small>↓ 5.69% vs 2022</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="p-3 bg-warning text-dark rounded shadow-sm">
                <h6 class="mb-1">Consumo per cápita</h6>
                <h3 class="fw-bold">77.92 GJ</h3>
                <small>↓ 3.35% vs 2022</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="p-3 bg-info text-white rounded shadow-sm">
                <h6 class="mb-1">Producción primaria</h6>
                <h3 class="fw-bold">7,365 PJ</h3>
                <small>↓ 1.39% vs 2022</small>
            </div>
        </div>
    </div>

    <!-- Sankey -->
    <div class="mb-5">
        <h5 class="fw-semibold mb-3">Flujo Energético Nacional (Sankey)</h5>
        <iframe src="/mnt/data/sankey_balance_energia_2023.html"
            style="width:100%; height:600px; border:none;"></iframe>
    </div>

    <!-- Gráfico de columnas -->
    <div class="mb-4">
        <h5 class="fw-semibold">Consumo Energético por Sector</h5>
        <div id="graficoConsumo" style="height: 400px;"></div>
    </div>

    <!-- Tabla de resumen -->
    <div class="mb-4">
        <h5 class="fw-semibold">Resumen del Balance Energético 2023</h5>
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>Indicador</th>
                        <th>Valor</th>
                        <th>Variación</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Importaciones Energéticas</td>
                        <td>4,556 PJ</td>
                        <td class="text-danger">↑ 5.45%</td>
                    </tr>
                    <tr>
                        <td>Exportaciones Energéticas</td>
                        <td>2,855 PJ</td>
                        <td class="text-success">↑ 6.13%</td>
                    </tr>
                    <tr>
                        <td>Consumo Nacional Total</td>
                        <td>10,217 PJ</td>
                        <td class="text-danger">↓ 2.47%</td>
                    </tr>
                    <tr>
                        <td>Transporte</td>
                        <td>2,567 PJ</td>
                        <td class="text-muted">48.80% del total</td>
                    </tr>
                    <tr>
                        <td>Industrial</td>
                        <td>1,239 PJ</td>
                        <td class="text-danger">↓ 16.12%</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script>
        Highcharts.chart('graficoConsumo', {
            chart: { type: 'column' },
            title: { text: 'Distribución del Consumo Energético 2023' },
            xAxis: {
                categories: ['Transporte', 'Industrial', 'Residencial', 'Agropecuario', 'No Clasificado']
            },
            yAxis: {
                title: { text: 'Petajoules (PJ)' }
            },
            series: [{
                name: 'Consumo por Sector',
                data: [2567.72, 1238.96, 972.58, 183.22, 299.49]
            }]
        });
    </script>
}
