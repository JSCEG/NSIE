<!DOCTYPE html>
<!-- saved from url=(0040)http://127.0.0.1:5500/SankeyEnergeo.html -->
<html lang="es"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style>
    #sankeyContainer {
      position: relative;
      width: 600px;
      height: 400px;
      border: 1px solid black;
    }

    .link {
    position: absolute;
    background-color: gray;
    transform-origin: top left;
    z-index: 1;  /* Índice z más bajo */
}

.node {
    position: absolute;
    width: 100px; /* Aumentar el ancho para acomodar el nombre y el valor */
    height: 50px; /* Aumentar el alto para acomodar el nombre y el valor */
    background-color: lightblue;
    border-radius: 5px;
    z-index: 2;
    padding: 5px;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    font-family: Arial, sans-serif;
}

.node .nodeName {
    font-weight: bold;
}

.node .nodeValue {
    font-size: 12px;
    color: gray;
}


  </style>
  
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sankey Básico</title>
    <link rel="stylesheet" href="Sankey%20Básico_files/styles.css">
  </head>
  <body>
    <svg id="sankeyContainer" width="600" height="400">
        <g id="linksGroup"></g>
        <g id="nodesGroup"></g>
    <rect x="50" y="50" width="100" height="50" fill="red"></rect><text x="55" y="70" fill="black">Nodo A</text><text x="55" y="90" fill="gray">Valor: 10</text></svg>
    
    <!-- <div id="sankeyContainer"></div> -->
    <script>
              let nodes = [];
      let links = [];

      function createLink(source, target) {
    const svgNS = "http://www.w3.org/2000/svg";
    const sourceNode = nodes[source];
    const targetNode = nodes[target];

    // Calculamos el punto central de los nodos
    const sourceCenterX = sourceNode.x + 50; // Añadimos la mitad del ancho del nodo
    const sourceCenterY = sourceNode.y + 25; // Añadimos la mitad del alto del nodo

    const targetCenterX = targetNode.x + 50;
    const targetCenterY = targetNode.y + 25;

    // Creamos un enlace curvo usando una curva de Bézier cúbica
    const pathData = `M ${sourceCenterX} ${sourceCenterY} C ${sourceCenterX + (targetCenterX - sourceCenterX) / 2} ${sourceCenterY}, ${sourceCenterX + (targetCenterX - sourceCenterX) / 2} ${targetCenterY}, ${targetCenterX} ${targetCenterY}`;
    
    const path = document.createElementNS(svgNS, 'path');
    path.setAttribute('d', pathData);
    path.setAttribute('stroke', 'gray');
    path.setAttribute('stroke-width', '5');
    path.setAttribute('fill', 'none');

    document.getElementById('sankeyContainer').appendChild(path);
    links.push({ source: source, target: target });
}

// Para que los nodos sean visibles en SVG, debemos modificar la función createNode.
function createNode(x, y, name, value, color) {
    const rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
    rect.setAttribute('x', x);
    rect.setAttribute('y', y);
    rect.setAttribute('width', 100);
    rect.setAttribute('height', 50);
    rect.setAttribute('fill', color);
    document.getElementById('sankeyContainer').appendChild(rect);
    
    const text = document.createElementNS("http://www.w3.org/2000/svg", 'text');
    text.setAttribute('x', x + 5);
    text.setAttribute('y', y + 20);
    text.setAttribute('fill', 'black');
    text.textContent = name;
    document.getElementById('sankeyContainer').appendChild(text);

    const valueText = document.createElementNS("http://www.w3.org/2000/svg", 'text');
    valueText.setAttribute('x', x + 5);
    valueText.setAttribute('y', y + 40);
    valueText.setAttribute('fill', 'gray');
    valueText.textContent = value;
    document.getElementById('sankeyContainer').appendChild(valueText);

    nodes.push({ x: x, y: y, name: name, value: value, color: color });
    document.getElementById('linksGroup').appendChild(path); // Cambio aquí
    links.push({ source: source, target: target });
    const nodesGroup = document.getElementById('nodesGroup');
    nodesGroup.appendChild(rect);  // Cambio aquí
    nodesGroup.appendChild(text);  // Cambio aquí
    nodesGroup.appendChild(valueText);  // Cambio aquí

    nodes.push({ x: x, y: y, name: name, value: value, color: color });
}

      // Ejemplo de uso:
      createNode(50, 50, "Nodo A", "Valor: 10", "red");
      createNode(250, 250, "Nodo B", "Valor: 20", "green");


      createLink(0, 1);
     // createLink(1, 0);
    </script>
  <!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>


</body></html>