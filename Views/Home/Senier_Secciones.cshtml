@model HomeIndex
@using NSIE.Models
@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Tabla Detallada de Secciones y Módulos - SNIEr";
    var perfilJson = HttpContextAccessor.HttpContext.Session.GetString("PerfilUsuario");
    var perfilUsuario = JsonConvert.DeserializeObject<PerfilUsuario>(perfilJson);
}

<div class="container-fluid">
    <h2 class="text-center mb-4">📊 Tabla Detallada por Sección y Módulo - SNIEr</h2>

    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>Sección</th>
                    <th>Módulo</th>
                    <th>Fundamento Legal</th>
                    <th>Roles que Interactúan</th>
                    <th>Etapa</th>
                    <th>Justificación del Orden</th>
                    <th>Ayuda Contextual</th>
                </tr>
            </thead>
            <tbody>
                <!-- 1. Gobernanza y Seguridad -->
                <tr>
                    <td rowspan="3">🔐 Gobernanza y Seguridad<br>(Art. 70, 71, 76)</td>
                    <td>Gestión de Usuarios y Perfiles</td>
                    <td>Art. 70 RLPT</td>
                    <td>Administrador (1)</td>
                    <td>Configuración inicial</td>
                    <td>Base para establecer accesos y permisos del sistema</td>
                    <td>Administra perfiles, roles y accesos según normativa</td>
                </tr>
                <tr>
                    <td>Seguridad y Auditoría</td>
                    <td>Art. 71 RLPT</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Monitoreo continuo</td>
                    <td>Garantiza trazabilidad y seguridad de operaciones</td>
                    <td>Supervisa acciones del sistema y alertas de seguridad</td>
                </tr>
                <tr>
                    <td>Subsistemas Externos Integrados</td>
                    <td>Art. 69 RLPT</td>
                    <td>Administrador (1), Consejo (7), Sectorizado (8)</td>
                    <td>Integración</td>
                    <td>Permite incorporación de entidades federativas y municipios</td>
                    <td>Consulta integración de entidades externas al SNIEr</td>
                </tr>

                <!-- 2. Carga, Validación y CRM -->
                <tr>
                    <td rowspan="3">🧾 Carga, Validación y CRM<br>(Art. 70, 71, 73, 76)</td>
                    <td>Carga de Información</td>
                    <td>Art. 70 RLPT</td>
                    <td>Administrador (1), Sectorizado (8)</td>
                    <td>Captura</td>
                    <td>Punto inicial para registro de datos energéticos</td>
                    <td>Permite carga masiva de información sectorial</td>
                </tr>
                <tr>
                    <td>Validación y Firma</td>
                    <td>Art. 71 RLPT</td>
                    <td>Administrador (1), Sectorizado (8)</td>
                    <td>Validación</td>
                    <td>Garantiza autenticidad de datos con e.firma</td>
                    <td>Valida registros y genera acuse con firma electrónica</td>
                </tr>
                <tr>
                    <td>Notificaciones y Oficios</td>
                    <td>Art. 73 RLPT</td>
                    <td>Administrador (1), Consejo (7), Sectorizado (8)</td>
                    <td>Comunicación</td>
                    <td>Establece canal oficial de notificaciones</td>
                    <td>Gestiona comunicación interna y acuses de recibo</td>
                </tr>

                <!-- 3. Datos Públicos -->
                <tr>
                    <td rowspan="6">📊 Datos Públicos<br>(Art. 70, 76, 77, 111)</td>
                    <td>Boletín de CELs</td>
                    <td>Art. 70-II-b RLPT</td>
                    <td>Todos (0,1,7,8)</td>
                    <td>Difusión</td>
                    <td>Información clave sobre certificados de energías limpias</td>
                    <td>Consulta reportes públicos sobre CELs</td>
                </tr>
                <tr>
                    <td>Balance Nacional de Energía</td>
                    <td>Art. 70-II-a RLPT</td>
                    <td>Todos (0,1,7,8)</td>
                    <td>Análisis</td>
                    <td>Visualización oficial del flujo energético nacional</td>
                    <td>Diagrama Sankey del balance energético</td>
                </tr>
                <tr>
                    <td>Catálogo de Tecnologías</td>
                    <td>Art. 70-V RLPT</td>
                    <td>Todos (0,1,7,8)</td>
                    <td>Consulta</td>
                    <td>Base técnica para decisiones de generación</td>
                    <td>Parámetros técnicos y económicos de tecnologías</td>
                </tr>
                <tr>
                    <td>Equipos y Aparatos Energéticos</td>
                    <td>Art. 70-IV RLPT</td>
                    <td>Todos (0,1,7,8)</td>
                    <td>Consulta</td>
                    <td>Información sobre consumo de equipos relevantes</td>
                    <td>Datos de consumo energético de equipos</td>
                </tr>
                <tr>
                    <td>Mercado Eléctrico Mayorista</td>
                    <td>Art. 70-II-b RLPT</td>
                    <td>Administrador (1), Consejo (7), Sectorizado (8)</td>
                    <td>Monitoreo</td>
                    <td>Información clave del mercado de corto plazo</td>
                    <td>Consulta desempeño del mercado mayorista</td>
                </tr>
                <tr>
                    <td>Precios de Estaciones</td>
                    <td>Art. 77 RLPT</td>
                    <td>Todos (0,1,7,8)</td>
                    <td>Transparencia</td>
                    <td>Datos oficiales de precios por zona</td>
                    <td>Consulta precios actualizados de combustibles</td>
                </tr>

                <!-- 10. Programa del Consejo -->
                <tr>
                    <td rowspan="13">📆 Programa del Consejo<br>(Art. 76)</td>
                    <td>Programa de Trabajo del Consejo</td>
                    <td>Art. 76 RLPT; Art. 10 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Planeación</td>
                    <td>Establece metas y actividades anuales del Consejo</td>
                    <td>Consulta objetivos y recursos del Programa Anual</td>
                </tr>
                <tr>
                    <td>Avance de Metas y Líneas de Acción</td>
                    <td>Art. 76 RLPT; Art. 45 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Seguimiento</td>
                    <td>Monitorea cumplimiento del Programa Anual</td>
                    <td>Visualiza avance de metas con KPIs y semáforos</td>
                </tr>
                <tr>
                    <td>Orden del Día y Convocatorias</td>
                    <td>Art. 76 RLPT; Art. 14-17 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Preparación</td>
                    <td>Define agenda y estructura de cada sesión</td>
                    <td>Consulta convocatorias y documentos de sesiones</td>
                </tr>
                <tr>
                    <td>Votaciones Colegiadas</td>
                    <td>Art. 76 RLPT; Art. 32 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Deliberación</td>
                    <td>Permite votación digital sobre puntos en agenda</td>
                    <td>Interfaz para votación colegiada con quórum</td>
                </tr>
                <tr>
                    <td>Firma de Actas del Consejo</td>
                    <td>Art. 76 RLPT; Art. 30 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Formalización</td>
                    <td>Da validez jurídica a acuerdos con e.firma</td>
                    <td>Firma digital de actas y acuerdos</td>
                </tr>
                <tr>
                    <td>Acuerdos de Coordinación</td>
                    <td>Art. 71 y 76 RLPT; Art. 28-34 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Seguimiento</td>
                    <td>Centraliza acuerdos formales del Consejo</td>
                    <td>Consulta estatus de cumplimiento de acuerdos</td>
                </tr>
                <tr>
                    <td>Buzón de Asuntos del Consejo</td>
                    <td>Art. 76 RLPT; Art. 21-25 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Registro</td>
                    <td>Punto de entrada para nuevos temas a tratar</td>
                    <td>Registro de propuestas de asuntos para sesiones</td>
                </tr>
                <tr>
                    <td>Indicadores del Consejo</td>
                    <td>Art. 76 RLPT; Art. 45 y 47 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Evaluación</td>
                    <td>Mide desempeño colegiado con métricas</td>
                    <td>Dashboard con indicadores clave de gestión</td>
                </tr>
                <tr>
                    <td>Trazabilidad de Acuerdos</td>
                    <td>Art. 76 RLPT; Art. 21-33 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Trazabilidad</td>
                    <td>Seguimiento completo del ciclo de cada tema</td>
                    <td>Línea de tiempo de cada asunto deliberado</td>
                </tr>
                <tr>
                    <td>Repositorio de Sesiones</td>
                    <td>Art. 30-31 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Consulta</td>
                    <td>Archivo histórico de sesiones anteriores</td>
                    <td>Acceso a actas y documentos de sesiones pasadas</td>
                </tr>
                <tr>
                    <td>Consultas Públicas</td>
                    <td>Art. 77 RLPT</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Transparencia</td>
                    <td>Difusión de acuerdos y votaciones públicas</td>
                    <td>Visualiza información de acceso público</td>
                </tr>
                <tr>
                    <td>Integrantes y Roles</td>
                    <td>Art. 11-13 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Estructura</td>
                    <td>Identifica participantes y sus facultades</td>
                    <td>Consulta composición del Consejo</td>
                </tr>
                <tr>
                    <td>Asesoría Técnica y Documentación</td>
                    <td>Art. 18 Lineamientos</td>
                    <td>Administrador (1), Consejo (7)</td>
                    <td>Apoyo</td>
                    <td>Provee insumos técnicos para decisiones</td>
                    <td>Acceso a documentos de apoyo y análisis</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<style>
    .table {
        font-size: 0.9rem;
    }

    .table thead th {
        position: sticky;
        top: 0;
        background-color: #343a40;
        color: white;
        vertical-align: middle;
    }

    .table td,
    .table th {
        vertical-align: middle;
    }

    td[rowspan] {
        vertical-align: top;
        font-weight: bold;
        background-color: #f8f9fa;
    }

    .table-hover tbody tr:hover {
        background-color: rgba(0, 0, 0, .03);
    }
</style>