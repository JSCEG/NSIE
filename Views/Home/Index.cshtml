@model HomeIndex
@using NSIE.Models
@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Sistema Nacional de Informaci贸n Energ茅tica (SNIEr)";
    var perfilJson = HttpContextAccessor.HttpContext.Session.GetString("PerfilUsuario");
    var perfilUsuario = JsonConvert.DeserializeObject<PerfilUsuario>(perfilJson);
    ViewData["NombreUsuario"] = perfilUsuario.Nombre;
    ViewData["RolUsuario"] = perfilUsuario.Rol;
    ViewData["IDUsuario"] = perfilUsuario.IdUsuario;

    var secciones = new[] {
        new { Titulo = " Gobernanza y Seguridad", Articulos = "Art. 70, 71, 76", Descripcion = "Control de usuarios, roles, trazabilidad, firma digital y clasificaci贸n de datos." },
        new { Titulo = "Ь Carga, Validaci贸n y CRM", Articulos = "Art. 70, 71, 73, 76", Descripcion = "Carga masiva, validaci贸n, notificaciones, oficios institucionales y firma digital." },
        new { Titulo = " Datos P煤blicos", Articulos = "Art. 70, 76, 77, 111", Descripcion = "Consulta de informaci贸n p煤blica, boletines, precios, CELs y balance energ茅tico." },
        new { Titulo = " Indicadores", Articulos = "Art. 70, 76", Descripcion = "Consulta de indicadores estrat茅gicos y de eficiencia institucional." },
        new { Titulo = "锔 Obligaciones y Cumplimiento", Articulos = "Art. 70, 76", Descripcion = "Sem谩foros de cumplimiento, obligaciones normativas y sanciones." },
        new { Titulo = " Proyectos Estrat茅gicos y Anal铆tica", Articulos = "Art. 70, 76", Descripcion = "Seguimiento de proyectos, modelos predictivos, metas energ茅ticas y evaluaci贸n de proyectos." },
        new { Titulo = " An谩lisis Geoespacial", Articulos = "Art. 66-70, 75", Descripcion = "Mapas energ茅ticos, infraestructura, riesgos y potencial renovable." },
        new { Titulo = " Interoperabilidad y Configuraci贸n", Articulos = "Art. 70, 72, Transitorio Segundo", Descripcion = "APIs, conectores, reglas de operaci贸n y evoluci贸n modular del sistema." },
        new { Titulo = " Normatividad y Disposiciones", Articulos = "Art. 71-72", Descripcion = "Gesti贸n de reglas, formatos, lineamientos, instructivos y pol铆ticas t茅cnicas." },
        new { Titulo = " Planeaci贸n Vinculante", Articulos = "Art. 66, 67, 111", Descripcion = "Repositorio oficial de documentos estrat茅gicos del SNIEr." },
        new { Titulo = " Programa del Consejo", Articulos = "Art. 76", Descripcion = "Objetivos, metas, recursos, asesor铆as t茅cnicas y mesa de ayuda anual del SNIEr." },
        new { Titulo = " Difusi贸n y Fuente Oficial", Articulos = "Art. 77", Descripcion = "Mecanismo de difusi贸n oficial y citaci贸n obligatoria del SNIEr como fuente de informaci贸n." }
    };

    var modulosSnie = new[] {

    // Nuevos m贸dulos derivados del Reglamento

    new { Seccion = secciones[0].Titulo, Controller = "Usuarios", Action = "AdministrarUsuarios", Title = "Gesti贸n de Usuarios y Perfiles", Desc = "Administra perfiles, roles y accesos.", Img = "usuarios_scel.png", Btn = "Administrar" },
    new { Seccion = secciones[0].Titulo, Controller = "Bitacora", Action = "Dashboard", Title = "Seguridad y Auditor铆a", Desc = "Supervisa acciones del sistema y alertas.", Img = "seguridad_alertas_scel.png", Btn = "Ver Acciones" },
    new { Seccion = secciones[0].Titulo, Controller = "SNIE", Action = "SubsistemasExternos", Title = "Subsistemas Externos Integrados", Desc = "Consulta la integraci贸n de entidades federativas, municipios y privados (Art. 69).", Img = "subsistemas.png", Btn = "Consultar" },

    // 1.-Carga, Validaci贸n y CRM
    new { Seccion = secciones[1].Titulo, Controller = "SNIE", Action = "CargaInformacion", Title = "Carga de Informaci贸n", Desc = "Colaboradores registran datos clave.", Img = "carga_info.png", Btn = "Subir Archivos" },
    new { Seccion = secciones[1].Titulo, Controller = "SNIE", Action = "ValidacionFirma", Title = "Validaci贸n y Firma", Desc = "Valida registros y genera acuse con e.firma.", Img = "firma.png", Btn = "Firmar" },
    new { Seccion = secciones[1].Titulo, Controller = "SNIE", Action = "BuzonNotificaciones", Title = "Notificaciones y Oficios", Desc = "Consulta notificaciones internas y acuses.", Img = "notificaciones.png", Btn = "Consultar" },

    // 2.-Datos P煤blicos
    new { Seccion = secciones[2].Titulo, Controller = "EnergiasLimpias", Action = "Certificados", Title = "Bolet铆n de CELs", Desc = "Consulta los reportes sobre certificados de energ铆as limpias.", Img = "cel.png", Btn = "Ver CELs" },
    new { Seccion = secciones[2].Titulo, Controller = "EnergiasLimpias", Action = "FactorEmision", Title = "Factor de Emisi贸n", Desc = "Consulta indicadores de emisi贸n del SEN.", Img = "emision.png", Btn = "Consultar" },
    new { Seccion = secciones[2].Titulo, Controller = "Sankey", Action = "Sankey", Title = "Balance Nacional de Energ铆a", Desc = "Visualiza el flujo energ茅tico nacional.", Img = "sankey.png", Btn = "Explorar" },
    new { Seccion = secciones[2].Titulo, Controller = "Map", Action = "I_Petroliferos", Title = "Precios de Estaciones", Desc = "Consulta precios actualizados por zona.", Img = "gasolinera.png", Btn = "Ver Precios" },
    new { Seccion = secciones[2].Titulo, Controller = "Indicadores", Action = "Precio_Gas_LP", Title = "Precios de Gas L.P.", Desc = "Consulta precios hist贸ricos de Gas L.P.", Img = "precio.png", Btn = "Ver Hist贸ricos" },
    new { Seccion = secciones[2].Titulo, Controller = "Tarifas", Action = "TarifasMI", Title = "Tarifas El茅ctricas", Desc = "Consulta tarifas de electricidad a nivel nacional.", Img = "precio.png", Btn = "Consultar Tarifas" },

    // 3.-Indicadores
    new { Seccion = secciones[3].Titulo, Controller = "Indicadores", Action = "IndicadoresInstitucionales", Title = "Indicadores de Eficiencia por rea", Desc = "Monitorea el desempe帽o estrat茅gico, operativo y de gesti贸n institucional.", Img = "indicadores.png", Btn = "Ver Indicadores" },

    // 4.-Obligaciones y Cumplimiento
    new { Seccion = secciones[4].Titulo, Controller = "SNIE", Action = "VerificadorDatos", Title = "Verificador de Datos", Desc = "Valida incongruencias en la informaci贸n registrada por los subsistemas (Art. 112).", Img = "verificador.png", Btn = "Verificar" },
    new { Seccion = secciones[4].Titulo, Controller = "SNIE", Action = "Semaforo", Title = "Sem谩foro de Carga", Desc = "Visualiza el estado por dependencia (Verde, Amarillo, Rojo).", Img = "semaforo.png", Btn = "Ver Sem谩foro" },
    new { Seccion = secciones[4].Titulo, Controller = "SNIE", Action = "ObligacionesEntrega", Title = "Control de Entregas SNIEr", Desc = "Consulta el cumplimiento de entrega de informaci贸n por subsistema (Art. 74).", Img = "entregas.png", Btn = "Revisar" },

    // 5.-Proyectos Estrat茅gicos y Anal铆tica
    new { Seccion = secciones[5].Titulo, Controller = "Proyectos", Action = "FOTEASE", Title = "FOTEASE", Desc = "Fondo para Transici贸n Energ茅tica y el Aprovechamiento Sustentable de la Energ铆a.", Img = "fotease.png", Btn = "Consultar" },
    new { Seccion = secciones[5].Titulo, Controller = "Proyectos", Action = "FSUE", Title = "FSUE (tentativo)", Desc = "Fondo del Servicio Universal El茅ctrico (nombre por confirmar).", Img = "fsue.png", Btn = "Consultar" },
    new { Seccion = secciones[5].Titulo, Controller = "Proyectos", Action = "FondoPetroleo", Title = "Fondo Mexicano del Petr贸leo (tentativo)", Desc = "Instrumento financiero relacionado con los ingresos derivados del petr贸leo.", Img = "fondopetroleo.png", Btn = "Consultar" },
    new { Seccion = secciones[5].Titulo, Controller = "Home", Action = "EnConstruccion", Title = "Seguimiento de Proyectos", Desc = "Monitorea el avance de proyectos estrat茅gicos del sector.", Img = "seguimiento_proyectos.png", Btn = "Ver Proyectos" },

    // 6.-An谩lisis Geoespacial
    new { Seccion = secciones[6].Titulo, Controller = "Home", Action = "EnConstruccion", Title = "Anal铆tica y Transici贸n Energ茅tica", Desc = "Consulta modelos predictivos, metas y escenarios.", Img = "analitica.png", Btn = "Ver Anal铆tica" },
    new { Seccion = secciones[6].Titulo, Controller = "Map", Action = "Infraestructura_SEM", Title = "An谩lisis Geoespacial", Desc = "Consulta mapas, capas estrat茅gicas y riesgos.", Img = "geo.png", Btn = "Explorar Mapa" },

    // 7.-Interoperabilidad y Configuraci贸n
    new { Seccion = secciones[7].Titulo, Controller = "Home", Action = "EnConstruccion", Title = "Interoperabilidad y Conectividad", Desc = "Consulta las integraciones con otros sistemas.", Img = "interoperabilidad.png", Btn = "Ver Conexiones" },
    new { Seccion = secciones[7].Titulo, Controller = "Home", Action = "EnConstruccion", Title = "Modificaci贸n de Variables Operativas", Desc = "Administra las variables operativas del sistema.", Img = "modificacion_variables_scel.png", Btn = "Modificar Variables" },

    // 8.-Normatividad y Disposiciones
    new { Seccion = secciones[8].Titulo, Controller = "Normatividad", Action = "Formatos", Title = "Gesti贸n de Reglas y Formatos", Desc = "Visualiza pol铆ticas, normas t茅cnicas, lineamientos e instructivos oficiales.", Img = "normas.png", Btn = "Consultar" },
    new { Seccion = secciones[8].Titulo, Controller = "Normatividad", Action = "RepositorioFormularios", Title = "Repositorio de Formularios del Sector Energ茅tico", Desc = "Consulta formatos estandarizados relacionados con tr谩mites energ茅ticos (Art. 73).", Img = "formularios.png", Btn = "Consultar" },

    // 9.-Planeaci贸n Vinculante
    new { Seccion = secciones[9].Titulo, Controller = "Repositorio", Action = "Documentos", Title = "Repositorio Estrat茅gico", Desc = "Consulta documentos vinculantes y estrategias energ茅ticas.", Img = "repositorio.png", Btn = "Acceder" },

    // 10.-Programa del Consejo
    new { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "ProgramaAnual", Title = "Programa de Trabajo del Consejo", Desc = "Consulta metas, recursos y actividades del SNIEr.", Img = "consejo.png", Btn = "Consultar" },
    new { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "AvanceMetas", Title = "Avance de Metas y L铆neas de Acci贸n", Desc = "Monitorea el cumplimiento del Programa Anual del Consejo (Art. 76).", Img = "metas.png", Btn = "Ver Avance" },

    // 11.-Difusi贸n y Fuente Oficial
    new { Seccion = secciones[11].Titulo, Controller = "Difusion", Action = "Citas", Title = "Difusi贸n Oficial y Citaci贸n", Desc = "Revisa c贸mo debe citarse oficialmente la informaci贸n del SNIEr.", Img = "difusion.png", Btn = "Ver Detalles" }
};
}


<div class="text-center">
    <h3 class="cp-section cp-grouping-section">
        <img src="~/img/iconos/sistema.png" alt="Icono personalizado" class="iconomenu">
        @ViewData["Title"]
    </h3>
</div>

<!-- Contenido por secciones -->
<div class="container pe-5 ps-5">
    @foreach (var seccion in secciones)
    {
        var modulos = modulosSnie.Where(m => m.Seccion == seccion.Titulo).ToList();
        if (modulos.Any())
        {
            <div class="row g-4 mt-4">
                <div class="col-12">
                    <h4 class="subtitulobus mb-3">@seccion.Titulo</h4>
<div class="alert alert-success mt-2" role="alert">
    <strong>驴Qu茅 hace?</strong> @seccion.Descripcion <br />
    <strong>Fundamento legal:</strong> @seccion.Articulos
</div>

                </div>
                @foreach (var mod in modulos)
                {
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <img src="~/img/@mod.Img" alt="@mod.Title" class="iconomenu mb-3" />
                                <h5>@mod.Title</h5>
                                <p>@mod.Desc</p>
                                <a asp-controller="@mod.Controller" asp-action="@mod.Action" class="btn btn-snie">@mod.Btn</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    }
</div>

<!-- Diagrama adicional -->
<div id="miDiv" class="">
    <h3 class="subtitulo mb-3 pt-5">Recursos e Infraestructura</h3>
</div>
<center>
    <partial name="_DiagramaSEM_N" />
    @* <partial name="_DiagramaSEM"/> *@
</center>