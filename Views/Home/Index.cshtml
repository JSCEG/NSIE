@model HomeIndex
@using NSIE.Models
@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "SNIE - Bienvenidos";
    var perfilJson = HttpContextAccessor.HttpContext.Session.GetString("PerfilUsuario");
    var perfilUsuario = JsonConvert.DeserializeObject<PerfilUsuario>(perfilJson);
    ViewData["NombreUsuario"] = perfilUsuario.Nombre;
    ViewData["RolUsuario"] = perfilUsuario.Rol;
    ViewData["MercadoUsuario"] = perfilUsuario.Mercado_ID;
    ViewData["IDUsuario"] = perfilUsuario.IdUsuario;
    bool isAdmin = perfilUsuario.Rol == "1";

    // Configuración de módulos
    var energiaModules = new[] {
        new { Controller="SNIE", Action="AltaColaboradores", Title="Alta de Colaboradores", Desc="Agrega a los responsables que subirán información energética.", Img="alta_colaboradores.png", Btn="Administrar" },
        new { Controller="SNIE", Action="CargaInformacion", Title="Carga de Información", Desc="Los colaboradores registran datos clave para el Balance Nacional.", Img="carga_info.png", Btn="Subir Archivos" },
        new { Controller="SNIE", Action="ValidacionFirma", Title="Validación y Firma", Desc="Valida lo enviado y simula el timbrado con e.firma generando un acuse.", Img="firma.png", Btn="Firmar Información" },
        new { Controller="SNIE", Action="Semaforo", Title="Semáforo de Carga", Desc="Visualiza el estado por dependencia (Verde, Amarillo, Rojo).", Img="semaforo.png", Btn="Ver Semáforo" },
        new { Controller="SNIE", Action="BuzonNotificaciones", Title="Buzón de Notificaciones", Desc="Revisa las notificaciones del SNIE", Img="notificaciones.png", Btn="Ver Notificaciones" },
        new { Controller="SNIE", Action="BalanceNacional", Title="Balance Nacional de Energía", Desc="Consulta el Tablero del Balance Nacional de Energía", Img="sankey.png", Btn="Ver Balance Nacional de Energía" }
    };

    var adminModules = new[] {
        new { Controller="Usuarios", Action="AdministrarUsuarios", Title="Gestión de Perfiles y Usuarios", Desc="Administra los perfiles y usuarios del sistema.", Img="usuarios_scel.png", Btn="Administrar" },
        new { Controller="Bitacora", Action="Dashboard", Title="Seguridad y Alertas", Desc="Revisa las alertas de seguridad del sistema.", Img="seguridad_alertas_scel.png", Btn="Ver Acciones" },
        new { Controller="Home", Action="EnConstruccion", Title="Modificación de Variables Operativas", Desc="Administra las variables operativas del sistema.", Img="modificacion_variables_scel.png", Btn="Modificar Variables" }
    };

    var publicModules = new[] {
        new { Controller="Inscripcion", Action="PreRegistro", Title="Inscripción e Ingreso al S-CEL", Desc="Solicitud de Inscripción de nuevos participantes.", Img="inscripcion_scel.png", Btn="Realizar Solicitud" },
        new { Controller="EnergiasLimpias", Action="Certificados", Title="Reportes y Boletín", Desc="Consulta los reportes y boletines sobre los CEL.", Img="reportes_scel.png", Btn="Consultar" }
        
    };
}

<div class="text-center">
    <h3 class="cp-section cp-grouping-section">
        <img src="~/img/iconos/sistema.png" alt="Icono personalizado" class="iconomenu">
        @ViewData["Title"]
    </h3>
</div>


<div class="container pe- ps-5">
    

    <!-- Carrusel de imágenes -->
    <div class="owl-carousel owl-theme mb-5">
        @foreach (var banner in new[] {
            new { Controller="EnergiasLimpias", Action="Certificados", Img="12.png", Alt="Certificados de Energías Limpias" },
            new { Controller="Map", Action="Infraestructura_SEM", Img="5.png", Alt="Sistema Energético Mexicano" },
            new { Controller="Sankey", Action="Sankey", Img="7.png", Alt="Flujo Físico de la Energía" }
        })
        {
            <div class="item">
                <a asp-controller="@banner.Controller" asp-action="@banner.Action">
                    <img src="~/img/banner/@banner.Img" alt="@banner.Alt" class="img-fluid" />
                </a>
            </div>
        }
    </div>


    <h3 class="text-center subtitulobus mt-5 mb-4">Módulo de Información Energética (SNIE)</h3>

    <div class="row g-4">
        @if (isAdmin)
        {
  
            @foreach (var mod in energiaModules)
            {
                <div class="col-md-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <img src="~/img/@mod.Img" alt="@mod.Title" class="iconomenu mb-3" />
                            <h5>@mod.Title</h5>
                            <p>@mod.Desc</p>
                            <a asp-controller="@mod.Controller" asp-action="@mod.Action" class="btn btn-snie">@mod.Btn</a>
                        </div>
                    </div>
                </div>
            }

            <div class="col-12 text-center mt-5">
                <h3>Módulo de Administración Interna</h3>
            </div>
            @foreach (var mod in adminModules)
            {
                <div class="col-md-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <img src="~/img/@mod.Img" alt="@mod.Title" class="iconomenu mb-3" />
                            <h5>@mod.Title</h5>
                            <p>@mod.Desc</p>
                            <a asp-controller="@mod.Controller" asp-action="@mod.Action" class="btn btn-snie">@mod.Btn</a>
                        </div>
                    </div>
                </div>
            }
        }

        @foreach (var mod in publicModules)
        {
            <div class="col-md-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-body text-center">
                        <img src="~/img/@mod.Img" alt="@mod.Title" class="iconomenu mb-3" />
                        <h5>@mod.Title</h5>
                        <p>@mod.Desc</p>
                        <a asp-controller="@mod.Controller" asp-action="@mod.Action" class="btn btn-snie">@mod.Btn</a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.owl-carousel').owlCarousel({
                loop: true,
                margin: 10,
                nav: true,
                items: 1,
                autoplay: true,
                autoplayTimeout: 3000,
                autoplayHoverPause: true
            });
        });
    </script>
}
