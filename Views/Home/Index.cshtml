@model HomeIndex
@using NSIE.Models
@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Sistema Nacional de Informaci贸n Energ茅tica (SNIEr)";
    var perfilJson = HttpContextAccessor.HttpContext.Session.GetString("PerfilUsuario");
    var perfilUsuario = JsonConvert.DeserializeObject<PerfilUsuario>(perfilJson);
    ViewData["NombreUsuario"] = perfilUsuario.Nombre;
    ViewData["RolUsuario"] = perfilUsuario.Rol;
    ViewData["IDUsuario"] = perfilUsuario.IdUsuario;



    var secciones = new[] {
        new { Titulo = " Gobernanza y Seguridad", Articulos = "Art. 70, 71, 76", Descripcion = "Control de usuarios, roles, trazabilidad, firma digital y clasificaci贸n de datos." },
        new { Titulo = "Ь Carga, Validaci贸n y CRM", Articulos = "Art. 70, 71, 73, 76", Descripcion = "Carga masiva, validaci贸n, notificaciones, oficios institucionales y firma digital." },
        new { Titulo = " Datos P煤blicos", Articulos = "Art. 70, 76, 77, 111", Descripcion = "Consulta de informaci贸n p煤blica, boletines, precios, CELs y balance energ茅tico." },
        new { Titulo = " Indicadores", Articulos = "Art. 70, 76", Descripcion = "Consulta de indicadores estrat茅gicos y de eficiencia institucional." },
        new { Titulo = "锔 Obligaciones y Cumplimiento", Articulos = "Art. 70, 76", Descripcion = "Sem谩foros de cumplimiento, obligaciones normativas y sanciones." },
        new { Titulo = " Proyectos Estrat茅gicos y Anal铆tica", Articulos = "Art. 70, 76", Descripcion = "Seguimiento de proyectos, modelos predictivos, metas energ茅ticas y evaluaci贸n de proyectos." },
        new { Titulo = " An谩lisis Geoespacial", Articulos = "Art. 66-70, 75", Descripcion = "Mapas energ茅ticos, infraestructura, riesgos y potencial renovable." },
        new { Titulo = " Interoperabilidad y Configuraci贸n", Articulos = "Art. 70, 72, Transitorio Segundo", Descripcion = "APIs, conectores, reglas de operaci贸n y evoluci贸n modular del sistema." },
        new { Titulo = " Normatividad y Disposiciones", Articulos = "Art. 71-72", Descripcion = "Gesti贸n de reglas, formatos, lineamientos, instructivos y pol铆ticas t茅cnicas." },
        new { Titulo = " Planeaci贸n Vinculante", Articulos = "Art. 66, 67, 111", Descripcion = "Repositorio oficial de documentos estrat茅gicos del SNIEr." },
        new { Titulo = " Programa del Consejo", Articulos = "Art. 76", Descripcion = "Objetivos, metas, recursos, asesor铆as t茅cnicas y mesa de ayuda anual del SNIEr." },
        new { Titulo = " Difusi贸n y Fuente Oficial", Articulos = "Art. 77", Descripcion = "Mecanismo de difusi贸n oficial y citaci贸n obligatoria del SNIEr como fuente de informaci贸n." }
    };

    var modulosSnie = new List<ModuloSNIER>
    {
    // Nuevos m贸dulos derivados del Reglamento
   new ModuloSNIER { Seccion = secciones[0].Titulo, Controller = "Usuarios", Action = "AdministrarUsuarios", Title = "Gesti贸n de Usuarios y Perfiles", Desc = "Administra perfiles, roles y accesos.", Img = "usuarios_scel.png", Btn = "Administrar", Roles = "1" },
        new ModuloSNIER { Seccion = secciones[0].Titulo, Controller = "Bitacora", Action = "Dashboard", Title = "Seguridad y Auditor铆a", Desc = "Supervisa acciones del sistema y alertas.", Img = "seguridad_alertas_scel.png", Btn = "Ver Acciones", Roles = "1,7" },
        new ModuloSNIER { Seccion = secciones[0].Titulo, Controller = "SNIE", Action = "SubsistemasExternos", Title = "Subsistemas Externos Integrados", Desc = "Consulta la integraci贸n de entidades federativas, municipios y privados (Art. 69).", Img = "subsistemas.png", Btn = "Consultar", Roles = "1,7,8" },
        
    
    // 1.-Carga, Validaci贸n y CRM
    new ModuloSNIER { Seccion = secciones[1].Titulo, Controller = "SNIE", Action = "CargaInformacion", Title = "Carga de Informaci贸n", Desc = "Colaboradores registran datos clave.", Img = "carga_info.png", Btn = "Subir Archivos", Roles = "1,8" },
    new ModuloSNIER { Seccion = secciones[1].Titulo, Controller = "SNIE", Action = "ValidacionFirma", Title = "Validaci贸n y Firma", Desc = "Valida registros y genera acuse con e.firma.", Img = "firma.png", Btn = "Firmar", Roles = "1,8" },
    new ModuloSNIER { Seccion = secciones[1].Titulo, Controller = "SNIE", Action = "BuzonNotificaciones", Title = "Notificaciones y Oficios", Desc = "Consulta notificaciones internas y acuses.", Img = "notificaciones.png", Btn = "Consultar", Roles = "1,7,8" },

    // 2.-Datos P煤blicos
    new ModuloSNIER { Seccion = secciones[2].Titulo, Controller = "EnergiasLimpias", Action = "Certificados", Title = "Bolet铆n de CELs", Desc = "Consulta los reportes sobre certificados de energ铆as limpias.", Img = "cel.png", Btn = "Ver CELs", Roles = "0,1,7,8" },
    new ModuloSNIER { Seccion = secciones[2].Titulo, Controller = "EnergiasLimpias", Action = "FactorEmision", Title = "Factor de Emisi贸n", Desc = "Consulta indicadores de emisi贸n del SEN.", Img = "emision.png", Btn = "Consultar", Roles = "0,1,7,8" },
    new ModuloSNIER { Seccion = secciones[2].Titulo, Controller = "Sankey", Action = "Sankey", Title = "Balance Nacional de Energ铆a", Desc = "Visualiza el flujo energ茅tico nacional.", Img = "sankey.png", Btn = "Explorar", Roles = "0,1,7,8" },
    new ModuloSNIER { Seccion = secciones[2].Titulo, Controller = "Map", Action = "I_Petroliferos", Title = "Precios de Estaciones", Desc = "Consulta precios actualizados por zona.", Img = "gasolinera.png", Btn = "Ver Precios", Roles = "0,1,7,8" },
    new ModuloSNIER { Seccion = secciones[2].Titulo, Controller = "Indicadores", Action = "Precio_Gas_LP", Title = "Precios de Gas L.P.", Desc = "Consulta precios hist贸ricos de Gas L.P.", Img = "precio.png", Btn = "Ver Hist贸ricos", Roles = "0,1,7,8" },
    new ModuloSNIER { Seccion = secciones[2].Titulo, Controller = "Tarifas", Action = "TarifasMI", Title = "Tarifas El茅ctricas", Desc = "Consulta tarifas de electricidad a nivel nacional.", Img = "precio.png", Btn = "Consultar Tarifas", Roles = "0,1,7,8" },
// 3.-Indicadores
new ModuloSNIER { Seccion = secciones[3].Titulo, Controller = "Indicadores", Action = "IndicadoresInstitucionales", Title = "Indicadores de Eficiencia por rea", Desc = "Monitorea el desempe帽o estrat茅gico, operativo y de gesti贸n institucional.", Img = "indicadores.png", Btn = "Ver Indicadores", Roles = "1,7,8" },

// 4.-Obligaciones y Cumplimiento
new ModuloSNIER { Seccion = secciones[4].Titulo, Controller = "SNIE", Action = "VerificadorDatos", Title = "Verificador de Datos", Desc = "Valida incongruencias en la informaci贸n registrada por los subsistemas (Art. 112).", Img = "verificador.png", Btn = "Verificar", Roles = "1,7,8" },
new ModuloSNIER { Seccion = secciones[4].Titulo, Controller = "SNIE", Action = "Semaforo", Title = "Sem谩foro de Carga", Desc = "Visualiza el estado por dependencia (Verde, Amarillo, Rojo).", Img = "semaforo.png", Btn = "Ver Sem谩foro", Roles = "1,7,8" },
new ModuloSNIER { Seccion = secciones[4].Titulo, Controller = "SNIE", Action = "ObligacionesEntrega", Title = "Control de Entregas SNIEr", Desc = "Consulta el cumplimiento de entrega de informaci贸n por subsistema (Art. 74).", Img = "entregas.png", Btn = "Revisar", Roles = "1,7,8" },

// 5.-Proyectos Estrat茅gicos y Anal铆tica
new ModuloSNIER { Seccion = secciones[5].Titulo, Controller = "Proyectos", Action = "FOTEASE", Title = "FOTEASE", Desc = "Fondo para Transici贸n Energ茅tica y el Aprovechamiento Sustentable de la Energ铆a.", Img = "fotease.png", Btn = "Consultar", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[5].Titulo, Controller = "Proyectos", Action = "FSUE", Title = "FSUE (tentativo)", Desc = "Fondo del Servicio Universal El茅ctrico (nombre por confirmar).", Img = "fsue.png", Btn = "Consultar", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[5].Titulo, Controller = "Proyectos", Action = "FondoPetroleo", Title = "Fondo Mexicano del Petr贸leo (tentativo)", Desc = "Instrumento financiero relacionado con los ingresos derivados del petr贸leo.", Img = "fondopetroleo.png", Btn = "Consultar", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[5].Titulo, Controller = "Home", Action = "EnConstruccion", Title = "Seguimiento de Proyectos", Desc = "Monitorea el avance de proyectos estrat茅gicos del sector.", Img = "seguimiento_proyectos.png", Btn = "Ver Proyectos", Roles = "1,7,8" },

// 6.-An谩lisis Geoespacial
new ModuloSNIER { Seccion = secciones[6].Titulo, Controller = "Indicadores", Action = "Menu_Mecanismo", Title = "Anal铆tica y Transici贸n Energ茅tica", Desc = "Consulta modelos predictivos, metas y escenarios.", Img = "analitica.png", Btn = "Ver Anal铆tica", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[6].Titulo, Controller = "Map", Action = "Infraestructura_SEM", Title = "An谩lisis Geoespacial", Desc = "Consulta mapas, capas estrat茅gicas y riesgos.", Img = "geo.png", Btn = "Explorar Mapa", Roles = "0,1,7,8" },

// 7.-Interoperabilidad y Configuraci贸n
new ModuloSNIER { Seccion = secciones[7].Titulo, Controller = "Home", Action = "EnConstruccion", Title = "Interoperabilidad y Conectividad", Desc = "Consulta las integraciones con otros sistemas.", Img = "interoperabilidad.png", Btn = "Ver Conexiones", Roles = "1" },

new ModuloSNIER { Seccion = secciones[7].Titulo, Controller = "Home", Action = "EnConstruccion", Title = "Modificaci贸n de Variables Operativas", Desc = "Administra las variables operativas del sistema.", Img = "modificacion_variables_scel.png", Btn = "Modificar Variables", Roles = "1" },

// 8.-Normatividad y Disposiciones
new ModuloSNIER { Seccion = secciones[8].Titulo, Controller = "Normatividad", Action = "Formatos", Title = "Gesti贸n de Reglas y Formatos", Desc = "Visualiza pol铆ticas, normas t茅cnicas, lineamientos e instructivos oficiales.", Img = "normas.png", Btn = "Consultar", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[8].Titulo, Controller = "Normatividad", Action = "RepositorioFormularios", Title = "Repositorio de Formularios del Sector Energ茅tico", Desc = "Consulta formatos estandarizados relacionados con tr谩mites energ茅ticos (Art. 73).", Img = "formularios.png", Btn = "Consultar", Roles = "1,7" },

// 9.-Planeaci贸n Vinculante
new ModuloSNIER { Seccion = secciones[9].Titulo, Controller = "Repositorio", Action = "Documentos", Title = "Repositorio Estrat茅gico", Desc = "Consulta documentos vinculantes y estrategias energ茅ticas.", Img = "repositorio.png", Btn = "Acceder", Roles = "1,7" },

// 10.-Programa del Consejo - Reorganizado seg煤n el orden definido
new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "ProgramaAnual", Title = "Programa de Trabajo del Consejo", Desc = "Consulta los objetivos, metas, recursos y actividades anuales del Consejo.", Img = "modulos/programa_anual.png", Btn = "Consultar", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "AvanceMetas", Title = "Avance de Metas y L铆neas de Acci贸n", Desc = "Monitorea el cumplimiento del Programa Anual con base en metas trazadas.", Img = "modulos/metas_consejo.png", Btn = "Ver Avance", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "OrdenDelDia", Title = "Orden del D铆a y Convocatorias", Desc = "Consulta las convocatorias, orden del d铆a y documentos de sesiones.", Img = "modulos/convocatorias.png", Btn = "Consultar", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "Votaciones", Title = "Votaciones Colegiadas", Desc = "Permite al Consejo emitir votos sobre asuntos en agenda colegiada.", Img = "modulos/votaciones_consejo.png", Btn = "Votar", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "FirmaActas", Title = "Firma de Actas del Consejo", Desc = "Visualiza y firma electr贸nicamente las actas de sesiones y acuerdos.", Img = "modulos/firma_actas.png", Btn = "Firmar Acta", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "AcuerdosCoordinacion", Title = "Acuerdos de Coordinaci贸n", Desc = "Consulta los acuerdos formales del Consejo y su estatus de cumplimiento.", Img = "modulos/acuerdos_coordinacion.png", Btn = "Ver Acuerdos", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "BuzonAsuntos", Title = "Buz贸n de Asuntos del Consejo", Desc = "Permite a las unidades y miembros registrar propuestas formales de asuntos a tratar en sesi贸n.", Img = "modulos/buzon_consejo.png", Btn = "Registrar Asunto", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "IndicadoresConsejo", Title = "Indicadores del Consejo", Desc = "Visualiza m茅tricas sobre sesiones, acuerdos, participaci贸n y cumplimiento.", Img = "modulos/indicadoresconsejo.png", Btn = "Ver Indicadores", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "TrazabilidadAcuerdos", Title = "Trazabilidad de Acuerdos", Desc = "Consulta la l铆nea del tiempo normativa y operativa de cada asunto deliberado.", Img = "modulos/trazabilidad.png", Btn = "Ver Trazabilidad", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "RepositorioSesiones", Title = "Repositorio de Sesiones", Desc = "Consulta actas, acuerdos y documentaci贸n hist贸rica de sesiones previas.", Img = "modulos/repositorio_sesiones.png", Btn = "Ver Repositorio", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "ConsultasPublicas", Title = "Consultas P煤blicas", Desc = "Visualiza los acuerdos y votaciones que son p煤blicos.", Img = "modulos/consultas_publicas.png", Btn = "Ver P煤blico", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "IntegrantesRoles", Title = "Integrantes y Roles", Desc = "Consulta a los integrantes del Consejo y su participaci贸n.", Img = "modulos/integrantes_roles.png", Btn = "Ver Integrantes", Roles = "1,7" },

new ModuloSNIER { Seccion = secciones[10].Titulo, Controller = "Consejo", Action = "AsesoriaTecnica", Title = "Asesor铆a T茅cnica y Documentaci贸n", Desc = "Accede a documentos de apoyo y an谩lisis t茅cnico que respaldan decisiones.", Img = "modulos/asesoria.png", Btn = "Ver Documentos", Roles = "1,7" }
};
}


<div class="text-center">
    <h3 class="cp-section cp-grouping-section">
        <img src="~/img/iconos/sistema.png" alt="Icono personalizado" class="iconomenu">
        @ViewData["Title"]
    </h3>
</div>

<!-- Contenido por secciones -->
<div class="container pe-5 ps-5">
@foreach (var seccion in secciones)
{
    var modulos = modulosSnie.Where(m => m.Seccion == seccion.Titulo).ToList();
    var modulosVisibles = modulos.Where(m => string.IsNullOrEmpty(m.Roles) || m.Roles.Split(',').Contains(perfilUsuario.Rol)).ToList();

    if (modulosVisibles.Any())
    {
        <div class="row g-4 mt-4">
            <div class="col-12">
                <h4 class="subtitulobus mb-3">@seccion.Titulo</h4>
                <div class="alert alert-success mt-2" role="alert">
                    <strong>驴Qu茅 hace?</strong> @seccion.Descripcion <br />
                    <strong>Fundamento legal:</strong> @seccion.Articulos
                </div>
            </div>
            @foreach (var mod in modulosVisibles)
            {
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <img src="~/img/@mod.Img" alt="@mod.Title" class="iconomenu mb-3" />
                            <h5>@mod.Title</h5>
                            <p>@mod.Desc</p>
                            <a asp-controller="@mod.Controller" asp-action="@mod.Action" class="btn btn-snie">@mod.Btn</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
}

</div>

<!-- Diagrama adicional -->
<div id="miDiv" class="">
    <h3 class="subtitulo mb-3 pt-5">Recursos e Infraestructura</h3>
</div>
<center>
    <partial name="_DiagramaSEM_N" />
    @* <partial name="_DiagramaSEM"/> *@
</center>