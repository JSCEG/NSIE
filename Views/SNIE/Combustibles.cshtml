@model dynamic
@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json
@inject IHttpContextAccessor HttpContextAccessor

@{
ViewData["Title"] = "Factores de Equivalencia Energética - SNIE";
var httpContext = HttpContextAccessor.HttpContext;
var perfilUsuarioJson = httpContext.Session.GetString("PerfilUsuario");
var perfilUsuario = JsonConvert.DeserializeObject<PerfilUsuario>(perfilUsuarioJson);

    var header = new HeaderViewModel
    {
    Title = "Factores de Equivalencia Energética y Poder Calorífico",
    IconPath = "combustible.png",
    Description = @"Catálogo oficial de factores de equivalencia energética para la Planeación Vinculante del Sistema
    Eléctrico Nacional conforme a la normatividad CONUEE-SENER.",
    Section = "⚡ Planeación Energética Nacional",
    ModuleInfo = JsonConvert.SerializeObject(new
    {
    title = "Factores de Equivalencia a BPE",
    description = @"Tabla técnica oficial para conversión a Barril de Petróleo Equivalente (BPE) según normatividad
    vigente.",
    functionality = "Facilita cálculos de equivalencia energética para reportes oficiales y planeación vinculante.",
    stage = "Consulta Técnica Normativa",
    roles = new[] {
    new { icon = "fire", text = "Combustibles Fósiles" },
    new { icon = "leaf", text = "Biocombustibles y Renovables" },
    new { icon = "atom", text = "Tecnologías Emergentes" },
    new { icon = "lightning-bolt", text = "Electricidad y CELs" }
    },
    order = new { step = 1, description = "Consulta de factores oficiales CONUEE" }
    })
    };
    }

    @await Html.PartialAsync("_ViewHeader", header)

    <!-- KPIs de Contexto Normativo -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-down">
        <div class="row g-4">
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 shadow-sm border-0"
                    style="background: linear-gradient(135deg, #e8f4f8 0%, #d1ecf1 100%); border-left: 4px solid #17a2b8 !important;">
                    <div class="card-body text-dark">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-balance-scale fa-2x me-3" style="color: #17a2b8;"></i>
                            <div>
                                <h6 class="card-title text-uppercase fw-bold mb-0" style="color: #0c5460;">Base
                                    Normativa</h6>
                                <p class="small mb-0" style="color: #6c757d;">CONUEE-SENER</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 shadow-sm border-0"
                    style="background: linear-gradient(135deg, #fce8e6 0%, #f8d7da 100%); border-left: 4px solid #dc3545 !important;">
                    <div class="card-body text-dark">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-file-contract fa-2x me-3" style="color: #dc3545;"></i>
                            <div>
                                <h6 class="card-title text-uppercase fw-bold mb-0" style="color: #721c24;">Referencia
                                </h6>
                                <p class="small mb-0" style="color: #6c757d;">DOF 2019-2024</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 shadow-sm border-0"
                    style="background: linear-gradient(135deg, #e7f3ff 0%, #cce7ff 100%); border-left: 4px solid #007bff !important;">
                    <div class="card-body text-dark">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-oil-can fa-2x me-3" style="color: #007bff;"></i>
                            <div>
                                <h6 class="card-title text-uppercase fw-bold mb-0" style="color: #004085;">Unidad Base
                                </h6>
                                <p class="small mb-0" style="color: #6c757d;">BPE (Barril Petroleo Equiv.)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 shadow-sm border-0"
                    style="background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%); border-left: 4px solid #28a745 !important;">
                    <div class="card-body text-dark">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-calculator fa-2x me-3" style="color: #28a745;"></i>
                            <div>
                                <h6 class="card-title text-uppercase fw-bold mb-0" style="color: #155724;">Aplicación
                                </h6>
                                <p class="small mb-0" style="color: #6c757d;">Planeación Vinculante SEN</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contexto Normativo -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-up">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-gradient text-white"
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Marco Normativo y Propósito
                    <button class="btn btn-sm btn-outline-light float-end" type="button" data-bs-toggle="collapse"
                        data-bs-target="#contextoNormativo">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </h5>
            </div>
            <div class="collapse show" id="contextoNormativo">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-8">
                            <h6 class="text-primary fw-bold mb-3">
                                <i class="fas fa-scroll me-2"></i>
                                Base Legal y Técnica
                            </h6>
                            <p class="mb-3">
                                Los factores de equivalencia energética aquí presentados se basan en la normatividad
                                oficial establecida por:
                            </p>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    <strong>CONUEE:</strong> Comisión Nacional para el Uso Eficiente de la Energía
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    <strong>SENER:</strong> Secretaría de Energía - Planeación del Sistema Eléctrico
                                    Nacional
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    <strong>DOF:</strong> Diario Oficial de la Federación (2019-2024)
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <div class="alert alert-info border-0 shadow-sm">
                                <h6 class="alert-heading">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    Propósito
                                </h6>
                                <small>
                                    Facilitar la conversión uniforme de diferentes fuentes energéticas a
                                    <strong>Barril de Petróleo Equivalente (BPE)</strong> para:
                                    <br>• Reportes oficiales<br>
                                    • Planeación vinculante<br>
                                    • Comparativos energéticos<br>
                                    • Balances nacionales
                                </small>
                                <hr>
                                <div class="mt-3">
                                    <h6 class="text-primary mb-2">
                                        <i class="fas fa-link me-1"></i>
                                        Enlaces Oficiales:
                                    </h6>
                                    <div class="d-grid gap-1">
                                        <a href="https://www.gob.mx/conuee" target="_blank"
                                            class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>CONUEE
                                        </a>
                                        <a href="https://www.gob.mx/sener" target="_blank"
                                            class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>SENER
                                        </a>
                                        <a href="https://dof.gob.mx/" target="_blank"
                                            class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>DOF
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla Principal de Factores de Equivalencia -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-up">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-gradient text-white"
                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-table me-2"></i>
                        Factores de Equivalencia Energética Oficiales
                    </h5>
                    <div class="d-flex align-items-center gap-2">
                        <div class="input-group" style="width: 250px;">
                            <span class="input-group-text bg-white">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" class="form-control" id="buscarCombustible"
                                placeholder="Buscar combustible...">
                        </div>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-sm btn-outline-light" data-bs-toggle="tooltip"
                                title="Exportar a Excel">
                                <i class="fas fa-file-excel"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-light" data-bs-toggle="tooltip"
                                title="Imprimir tabla">
                                <i class="fas fa-print"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-light" data-bs-toggle="modal"
                                data-bs-target="#modalAyuda" data-bs-toggle="tooltip" title="Ayuda y definiciones">
                                <i class="fas fa-question-circle"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table id="tablaFactoresEquivalencia" class="table table-striped table-hover mb-0">
                        <thead class="table-dark sticky-top">
                            <tr>
                                <th style="min-width: 200px;">
                                    <i class="fas fa-fire me-2"></i>Combustible/Energético
                                </th>
                                <th class="text-center" style="min-width: 120px;">
                                    <i class="fas fa-bolt me-2"></i>Poder Calorífico<br>
                                    <small class="text-muted">(MJ/kg o MJ/m³)</small>
                                </th>
                                <th class="text-center" style="min-width: 140px;">
                                    <i class="fas fa-oil-can me-2"></i>Factor BPE<br>
                                    <small class="text-muted">(BPE/unidad física)</small>
                                </th>
                                <th class="text-center" style="min-width: 120px;">
                                    <i class="fas fa-industry me-2"></i>Unidad Física
                                </th>
                                <th class="text-center" style="min-width: 100px;">
                                    <i class="fas fa-tags me-2"></i>Categoría
                                </th>
                                <th class="text-center" style="min-width: 100px;">
                                    <i class="fas fa-info-circle me-2"></i>Referencia
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- COMBUSTIBLES FÓSILES LÍQUIDOS -->
                            <tr class="table-secondary">
                                <td colspan="6" class="fw-bold text-center">
                                    <i class="fas fa-tint me-2"></i>COMBUSTIBLES FÓSILES LÍQUIDOS
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-danger me-2">Líquido</span>Petróleo Crudo</td>
                                <td class="text-center">42.7</td>
                                <td class="text-center fw-bold text-primary">1.000</td>
                                <td class="text-center">Barril</td>
                                <td class="text-center"><span class="badge bg-dark">Base</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-danger me-2">Líquido</span>Gasolinas</td>
                                <td class="text-center">44.0</td>
                                <td class="text-center fw-bold text-primary">0.840</td>
                                <td class="text-center">Barril</td>
                                <td class="text-center"><span class="badge bg-danger">Fósil</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-danger me-2">Líquido</span>Diesel/Gasóleo</td>
                                <td class="text-center">45.5</td>
                                <td class="text-center fw-bold text-primary">0.851</td>
                                <td class="text-center">Barril</td>
                                <td class="text-center"><span class="badge bg-danger">Fósil</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-danger me-2">Líquido</span>Combustóleo</td>
                                <td class="text-center">40.5</td>
                                <td class="text-center fw-bold text-primary">0.948</td>
                                <td class="text-center">Barril</td>
                                <td class="text-center"><span class="badge bg-danger">Fósil</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-danger me-2">Líquido</span>Querosenos/Turbosina</td>
                                <td class="text-center">43.3</td>
                                <td class="text-center fw-bold text-primary">0.825</td>
                                <td class="text-center">Barril</td>
                                <td class="text-center"><span class="badge bg-danger">Fósil</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>

                            <!-- COMBUSTIBLES GASEOSOS -->
                            <tr class="table-secondary">
                                <td colspan="6" class="fw-bold text-center">
                                    <i class="fas fa-cloud me-2"></i>COMBUSTIBLES GASEOSOS
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info me-2">Gas</span>Gas Natural</td>
                                <td class="text-center">38.0</td>
                                <td class="text-center fw-bold text-primary">0.178</td>
                                <td class="text-center">MMm³</td>
                                <td class="text-center"><span class="badge bg-info">Gaseoso</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info me-2">Gas</span>Gas Licuado de Petróleo (LP)</td>
                                <td class="text-center">46.1</td>
                                <td class="text-center fw-bold text-primary">0.827</td>
                                <td class="text-center">Barril</td>
                                <td class="text-center"><span class="badge bg-info">Gaseoso</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info me-2">Gas</span>Gas de Refinería</td>
                                <td class="text-center">49.5</td>
                                <td class="text-center fw-bold text-primary">0.140</td>
                                <td class="text-center">MMm³</td>
                                <td class="text-center"><span class="badge bg-info">Gaseoso</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>

                            <!-- COMBUSTIBLES SÓLIDOS -->
                            <tr class="table-secondary">
                                <td colspan="6" class="fw-bold text-center">
                                    <i class="fas fa-cubes me-2"></i>COMBUSTIBLES SÓLIDOS
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-secondary me-2">Sólido</span>Carbón Mineral</td>
                                <td class="text-center">24.0</td>
                                <td class="text-center fw-bold text-primary">0.405</td>
                                <td class="text-center">Tonelada</td>
                                <td class="text-center"><span class="badge bg-secondary">Sólido</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-secondary me-2">Sólido</span>Coque de Petróleo</td>
                                <td class="text-center">32.0</td>
                                <td class="text-center fw-bold text-primary">0.540</td>
                                <td class="text-center">Tonelada</td>
                                <td class="text-center"><span class="badge bg-secondary">Sólido</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>

                            <!-- BIOCOMBUSTIBLES -->
                            <tr class="table-secondary">
                                <td colspan="6" class="fw-bold text-center">
                                    <i class="fas fa-leaf me-2"></i>BIOCOMBUSTIBLES Y RENOVABLES
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success me-2">Bio</span>Etanol</td>
                                <td class="text-center">26.8</td>
                                <td class="text-center fw-bold text-primary">0.511</td>
                                <td class="text-center">Barril</td>
                                <td class="text-center"><span class="badge bg-success">Renovable</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success me-2">Bio</span>Biodiesel</td>
                                <td class="text-center">37.8</td>
                                <td class="text-center fw-bold text-primary">0.705</td>
                                <td class="text-center">Barril</td>
                                <td class="text-center"><span class="badge bg-success">Renovable</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success me-2">Bio</span>Biomasa Sólida</td>
                                <td class="text-center">15.0</td>
                                <td class="text-center fw-bold text-primary">0.253</td>
                                <td class="text-center">Tonelada</td>
                                <td class="text-center"><span class="badge bg-success">Renovable</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success me-2">Bio</span>Biogás</td>
                                <td class="text-center">23.0</td>
                                <td class="text-center fw-bold text-primary">0.109</td>
                                <td class="text-center">MMm³</td>
                                <td class="text-center"><span class="badge bg-success">Renovable</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>

                            <!-- TECNOLOGÍAS EMERGENTES -->
                            <tr class="table-secondary">
                                <td colspan="6" class="fw-bold text-center">
                                    <i class="fas fa-atom me-2"></i>TECNOLOGÍAS EMERGENTES
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-warning me-2">Emergente</span>Hidrógeno Verde</td>
                                <td class="text-center">120.0</td>
                                <td class="text-center fw-bold text-primary">0.057</td>
                                <td class="text-center">MMm³</td>
                                <td class="text-center"><span class="badge bg-warning">Emergente</span></td>
                                <td class="text-center"><i class="fas fa-flask text-warning" data-bs-toggle="tooltip"
                                        title="En desarrollo"></i></td>
                            </tr>

                            <!-- ELECTRICIDAD -->
                            <tr class="table-secondary">
                                <td colspan="6" class="fw-bold text-center">
                                    <i class="fas fa-bolt me-2"></i>ELECTRICIDAD
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary me-2">Eléctrico</span>Electricidad (MWh)</td>
                                <td class="text-center">3.6</td>
                                <td class="text-center fw-bold text-primary">0.608</td>
                                <td class="text-center">MWh</td>
                                <td class="text-center"><span class="badge bg-primary">Eléctrico</span></td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="CONUEE 2024"></i></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-light">
                <div class="row text-center">
                    <div class="col-md-3">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            <strong>BPE:</strong> Barril de Petróleo Equivalente
                        </small>
                    </div>
                    <div class="col-md-3">
                        <small class="text-muted">
                            <i class="fas fa-calendar me-1"></i>
                            <strong>Actualización:</strong> CONUEE 2024
                        </small>
                    </div>
                    <div class="col-md-3">
                        <small class="text-muted">
                            <i class="fas fa-database me-1"></i>
                            <strong>Registros:</strong> <span id="totalRegistros">20</span>
                        </small>
                    </div>
                    <div class="col-md-3">
                        <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                            data-bs-target="#modalFuentes">
                            <i class="fas fa-book me-1"></i>
                            <strong>Fuentes</strong>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculadora de Equivalencias -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-up">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-gradient text-white"
                style="background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%); color: #155724 !important; border-bottom: 3px solid #28a745;">
                <h5 class="mb-0" style="color: #155724 !important;">
                    <i class="fas fa-calculator me-2" style="color: #28a745;"></i>
                    Calculadora de Equivalencias Energéticas
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Seleccionar Combustible:</label>
                            <select class="form-select" id="selectCombustible">
                                <option value="">-- Seleccione un combustible --</option>
                                <option value="44.0|0.840|Barril">Gasolinas</option>
                                <option value="45.5|0.851|Barril">Diesel/Gasóleo</option>
                                <option value="38.0|0.178|MMm³">Gas Natural</option>
                                <option value="24.0|0.405|Tonelada">Carbón Mineral</option>
                                <option value="15.0|0.253|Tonelada">Biomasa Sólida</option>
                                <option value="120.0|0.057|MMm³">Hidrógeno Verde</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Cantidad:</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="inputCantidad"
                                    placeholder="Ingrese cantidad" min="0" step="0.01">
                                <span class="input-group-text" id="unidadFisica">Unidad</span>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-lg w-100" onclick="calcularEquivalencia()">
                            <i class="fas fa-calculator me-2"></i>Calcular Equivalencia
                        </button>
                    </div>
                    <div class="col-lg-6">
                        <div class="alert alert-info border-0 shadow-sm h-100 d-flex align-items-center">
                            <div class="w-100">
                                <h6 class="alert-heading">
                                    <i class="fas fa-lightbulb me-2"></i>Resultado:
                                </h6>
                                <div id="resultadoCalculadora" class="fs-5 fw-bold text-center">
                                    <div class="text-muted">
                                        <i class="fas fa-arrow-up me-2"></i>
                                        Seleccione un combustible y cantidad para calcular
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráfico Comparativo Mejorado -->
    <div class="container-fluid px-5 mb-5" data-aos="zoom-in">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-gradient text-white"
                style="background: linear-gradient(135deg, #fce8e6 0%, #f8d7da 100%); color: #721c24 !important; border-bottom: 3px solid #dc3545;">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0" style="color: #721c24 !important;">
                        <i class="fas fa-chart-bar me-2" style="color: #dc3545;"></i>
                        Comparativo de Poder Calorífico por Categoría
                    </h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm" style="color: #721c24; border-color: #721c24;"
                            onclick="toggleGraficoTipo()" data-bs-toggle="tooltip" title="Cambiar tipo de gráfico">
                            <i class="fas fa-exchange-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="graficoCombustibles" style="height: 500px;"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda -->
    <div class="modal fade" id="modalAyuda" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-question-circle me-2"></i>
                        Ayuda - Factores de Equivalencia Energética
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 class="text-primary mb-3"><i class="fas fa-info-circle me-2"></i>Definiciones Técnicas</h6>

                    <div class="accordion" id="accordionAyuda">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseOne">
                                    <i class="fas fa-oil-can me-2"></i>¿Qué es BPE?
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show"
                                data-bs-parent="#accordionAyuda">
                                <div class="accordion-body">
                                    <strong>BPE (Barril de Petróleo Equivalente)</strong> es una unidad de medida
                                    energética que equivale al contenido energético de un barril de petróleo crudo
                                    (aproximadamente 6.12 GJ).
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseTwo">
                                    <i class="fas fa-bolt me-2"></i>Poder Calorífico
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionAyuda">
                                <div class="accordion-body">
                                    Cantidad de energía que libera un combustible al ser quemado completamente. Se mide
                                    en MJ/kg para sólidos y líquidos, o MJ/m³ para gases.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseThree">
                                    <i class="fas fa-calculator me-2"></i>Factor de Conversión
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse"
                                data-bs-parent="#accordionAyuda">
                                <div class="accordion-body">
                                    Número que permite convertir una unidad física de combustible a BPE. Se calcula
                                    dividiendo el poder calorífico del combustible entre el poder calorífico del
                                    petróleo crudo.
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>
                    <h6 class="text-success mb-2"><i class="fas fa-link me-2"></i>Enlaces de Referencia:</h6>
                    <div class="row">
                        <div class="col-md-4">
                            <a href="https://www.gob.mx/conuee" target="_blank"
                                class="btn btn-outline-primary btn-sm w-100 mb-2">
                                <i class="fas fa-external-link-alt me-1"></i>CONUEE
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="https://www.gob.mx/sener" target="_blank"
                                class="btn btn-outline-success btn-sm w-100 mb-2">
                                <i class="fas fa-external-link-alt me-1"></i>SENER
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="https://dof.gob.mx/" target="_blank"
                                class="btn btn-outline-info btn-sm w-100 mb-2">
                                <i class="fas fa-external-link-alt me-1"></i>DOF
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Fuentes y Referencias -->
    <div class="modal fade" id="modalFuentes" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-book me-2"></i>
                        Fuentes Oficiales y Referencias Técnicas
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Fuentes Primarias -->
                        <div class="col-lg-6">
                            <h6 class="text-primary fw-bold mb-3">
                                <i class="fas fa-star me-2"></i>Fuentes Primarias Oficiales
                            </h6>

                            <div class="card mb-3 border-primary">
                                <div class="card-header bg-light">
                                    <strong><i class="fas fa-institution me-2 text-primary"></i>CONUEE - Comisión
                                        Nacional para el Uso Eficiente de la Energía</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small mb-2"><strong>Documento:</strong> "Factores de Equivalencia
                                        Energética 2024"</p>
                                    <p class="small mb-2"><strong>Publicación:</strong> Diciembre 2024</p>
                                    <div class="d-grid gap-2">
                                        <a href="https://www.gob.mx/conuee" target="_blank"
                                            class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>Sitio Oficial CONUEE
                                        </a>
                                        <a href="https://www.gob.mx/conuee/documentos/factores-de-equivalencia-energetica"
                                            target="_blank" class="btn btn-outline-secondary btn-sm">
                                            <i class="fas fa-file-pdf me-1"></i>Factores de Equivalencia (PDF)
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="card mb-3 border-success">
                                <div class="card-header bg-light">
                                    <strong><i class="fas fa-building me-2 text-success"></i>SENER - Secretaría de
                                        Energía</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small mb-2"><strong>Documento:</strong> "Manual de Metodologías para
                                        Cálculo de Equivalencias Energéticas"</p>
                                    <p class="small mb-2"><strong>Versión:</strong> 3.2 (2024)</p>
                                    <div class="d-grid gap-2">
                                        <a href="https://www.gob.mx/sener" target="_blank"
                                            class="btn btn-outline-success btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>Sitio Oficial SENER
                                        </a>
                                        <a href="https://www.gob.mx/sener/documentos/planeacion-energetica"
                                            target="_blank" class="btn btn-outline-secondary btn-sm">
                                            <i class="fas fa-chart-line me-1"></i>Planeación Energética
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="card mb-3 border-info">
                                <div class="card-header bg-light">
                                    <strong><i class="fas fa-newspaper me-2 text-info"></i>DOF - Diario Oficial de la
                                        Federación</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small mb-2"><strong>Publicaciones:</strong> Acuerdos y Resoluciones
                                        2019-2024</p>
                                    <p class="small mb-2"><strong>Última actualización:</strong> 15 de noviembre de 2024
                                    </p>
                                    <div class="d-grid gap-2">
                                        <a href="https://dof.gob.mx/" target="_blank"
                                            class="btn btn-outline-info btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>Sitio Oficial DOF
                                        </a>
                                        <a href="https://dof.gob.mx/nota_detalle.php?codigo=5708234" target="_blank"
                                            class="btn btn-outline-secondary btn-sm">
                                            <i class="fas fa-file-alt me-1"></i>Acuerdo CONUEE 2024
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Fuentes Técnicas y Normativas -->
                        <div class="col-lg-6">
                            <h6 class="text-success fw-bold mb-3">
                                <i class="fas fa-cogs me-2"></i>Referencias Técnicas y Normativas
                            </h6>

                            <div class="card mb-3 border-warning">
                                <div class="card-header bg-light">
                                    <strong><i class="fas fa-globe me-2 text-warning"></i>Estándares
                                        Internacionales</strong>
                                </div>
                                <div class="card-body">
                                    <ul class="small mb-2">
                                        <li><strong>API (American Petroleum Institute)</strong> - Estándares de petróleo
                                        </li>
                                        <li><strong>IEA (International Energy Agency)</strong> - Factores de conversión
                                        </li>
                                        <li><strong>ISO 14040/14044</strong> - Análisis de ciclo de vida energético</li>
                                    </ul>
                                    <div class="d-grid gap-2">
                                        <a href="https://www.api.org/" target="_blank"
                                            class="btn btn-outline-warning btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>API Standards
                                        </a>
                                        <a href="https://www.iea.org/" target="_blank"
                                            class="btn btn-outline-warning btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>IEA Energy Data
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="card mb-3 border-danger">
                                <div class="card-header bg-light">
                                    <strong><i class="fas fa-flask me-2 text-danger"></i>Metodologías de
                                        Cálculo</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small mb-2"><strong>Base metodológica:</strong></p>
                                    <ul class="small mb-2">
                                        <li>Poder calorífico superior (HHV - Higher Heating Value)</li>
                                        <li>Condiciones estándar: 15.56°C (60°F) y 1 atm</li>
                                        <li>Factores de densidad promedio por tipo de combustible</li>
                                        <li>Corrección por pureza y composición química</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="card mb-3 border-secondary">
                                <div class="card-header bg-light">
                                    <strong><i class="fas fa-database me-2 text-secondary"></i>Bases de Datos
                                        Consultadas</strong>
                                </div>
                                <div class="card-body">
                                    <ul class="small mb-2">
                                        <li><strong>SIE-SENER:</strong> Sistema de Información Energética</li>
                                        <li><strong>PEMEX:</strong> Reportes técnicos de refinación</li>
                                        <li><strong>CFE:</strong> Datos de generación eléctrica</li>
                                        <li><strong>CNH:</strong> Comisión Nacional de Hidrocarburos</li>
                                    </ul>
                                    <div class="d-grid gap-2">
                                        <a href="https://sie.energia.gob.mx/" target="_blank"
                                            class="btn btn-outline-secondary btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>SIE - Sistema de Información
                                            Energética
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notas Técnicas -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="alert alert-light border">
                                <h6 class="alert-heading text-dark">
                                    <i class="fas fa-info-circle me-2"></i>Notas Técnicas Importantes
                                </h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <small>
                                            <strong>• Actualización:</strong> Los factores se revisan anualmente por
                                            CONUEE<br>
                                            <strong>• Precisión:</strong> Valores con 3 decimales para cálculos
                                            oficiales<br>
                                            <strong>• Aplicación:</strong> Obligatorios para reportes al gobierno
                                            federal
                                        </small>
                                    </div>
                                    <div class="col-md-6">
                                        <small>
                                            <strong>• Validación:</strong> Aprobados por el Consejo de Planeación
                                            Energética<br>
                                            <strong>• Metodología:</strong> Basada en estándares internacionales<br>
                                            <strong>• Vigencia:</strong> Del 1 de enero al 31 de diciembre de 2024
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <a href="https://www.gob.mx/conuee/documentos" target="_blank" class="btn btn-primary">
                        <i class="fas fa-external-link-alt me-2"></i>Ver Todos los Documentos CONUEE
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda -->
    <div class="modal fade" id="modalAyuda" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-question-circle me-2"></i>
                        Ayuda y Definiciones - Factores de Equivalencia
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="accordion" id="acordeonAyuda">
                        <!-- BPE -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#bpe">
                                    <i class="fas fa-oil-can me-2"></i>¿Qué es BPE?
                                </button>
                            </h2>
                            <div id="bpe" class="accordion-collapse collapse show" data-bs-parent="#acordeonAyuda">
                                <div class="accordion-body">
                                    <strong>Barril de Petróleo Equivalente (BPE)</strong> es una unidad de medida
                                    energética estándar que permite comparar diferentes fuentes de energía. Un BPE
                                    equivale a la energía contenida en un barril de petróleo crudo (aproximadamente 159
                                    litros).
                                </div>
                            </div>
                        </div>

                        <!-- Poder Calorífico -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#poderCalorifico">
                                    <i class="fas fa-fire me-2"></i>Poder Calorífico
                                </button>
                            </h2>
                            <div id="poderCalorifico" class="accordion-collapse collapse"
                                data-bs-parent="#acordeonAyuda">
                                <div class="accordion-body">
                                    El <strong>poder calorífico</strong> es la cantidad de energía por unidad de masa
                                    que puede liberar un combustible al quemarse completamente. Se mide en megajulios
                                    por kilogramo (MJ/kg) o por metro cúbico (MJ/m³) para gases.
                                </div>
                            </div>
                        </div>

                        <!-- CONUEE -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#conuee">
                                    <i class="fas fa-institution me-2"></i>CONUEE
                                </button>
                            </h2>
                            <div id="conuee" class="accordion-collapse collapse" data-bs-parent="#acordeonAyuda">
                                <div class="accordion-body">
                                    La <strong>Comisión Nacional para el Uso Eficiente de la Energía (CONUEE)</strong>
                                    es el órgano técnico de la SENER responsable de promover la eficiencia energética y
                                    establecer los factores de equivalencia oficiales para México.
                                </div>
                            </div>
                        </div>

                        <!-- Planeación Vinculante -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#planeacion">
                                    <i class="fas fa-sitemap me-2"></i>Planeación Vinculante
                                </button>
                            </h2>
                            <div id="planeacion" class="accordion-collapse collapse" data-bs-parent="#acordeonAyuda">
                                <div class="accordion-body">
                                    La <strong>Planeación Vinculante del Sistema Eléctrico Nacional</strong> es un
                                    proceso obligatorio que define la expansión y operación del sistema eléctrico
                                    mexicano, utilizando estos factores para homologar diferentes fuentes energéticas.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-info me-2" data-bs-dismiss="modal" data-bs-toggle="modal"
                        data-bs-target="#modalFuentes">
                        <i class="fas fa-book me-2"></i>Ver Fuentes
                    </button>
                    <a href="https://www.gob.mx/conuee" target="_blank" class="btn btn-primary">
                        <i class="fas fa-external-link-alt me-2"></i>Visitar CONUEE
                    </a>
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>

    <script>
        $(document).ready(function () {
            // Inicializar tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Configurar tabla simple sin DataTables para evitar conflictos con filas de categoría
            // Solo agregamos funcionalidad de búsqueda personalizada
            $('#buscarCombustible').on('input', function () {
                var valor = $(this).val().toLowerCase();
                $('#tablaFactoresEquivalencia tbody tr').each(function () {
                    var fila = $(this);
                    if (!fila.hasClass('table-secondary')) {
                        var texto = fila.text().toLowerCase();
                        if (texto.indexOf(valor) > -1) {
                            fila.show();
                        } else {
                            fila.hide();
                        }
                    }
                });
            });

            // Inicializar gráfico
            crearGraficoComparativo();

            // Actualizar contador de registros
            $('#totalRegistros').text($('#tablaFactoresEquivalencia tbody tr').not('.table-secondary').length);
        });

        let tipoGrafico = 'column';

        function crearGraficoComparativo() {
            const categorias = {
                'Fósiles Líquidos': {
                    data: [44.0, 45.5, 40.5, 43.3],
                    combustibles: ['Gasolina', 'Diesel', 'Combustóleo', 'Queroseno'],
                    color: '#dc3545'
                },
                'Gaseosos': {
                    data: [38.0, 46.1, 49.5],
                    combustibles: ['Gas Natural', 'Gas LP', 'Gas Refinería'],
                    color: '#17a2b8'
                },
                'Sólidos': {
                    data: [24.0, 32.0],
                    combustibles: ['Carbón', 'Coque'],
                    color: '#6c757d'
                },
                'Renovables': {
                    data: [26.8, 37.8, 15.0, 23.0],
                    combustibles: ['Etanol', 'Biodiesel', 'Biomasa', 'Biogás'],
                    color: '#28a745'
                },
                'Emergentes': {
                    data: [120.0],
                    combustibles: ['Hidrógeno'],
                    color: '#ffc107'
                }
            };

            const series = Object.keys(categorias).map(categoria => ({
                name: categoria,
                data: categorias[categoria].data,
                color: categorias[categoria].color
            }));

            Highcharts.chart('graficoCombustibles', {
                chart: {
                    type: tipoGrafico,
                    backgroundColor: 'transparent'
                },
                title: {
                    text: 'Poder Calorífico por Categoría de Combustible',
                    style: { fontSize: '18px', fontWeight: 'bold' }
                },
                subtitle: {
                    text: 'Valores en MJ/kg - Fuente: CONUEE 2024'
                },
                xAxis: {
                    categories: [].concat(...Object.values(categorias).map(cat => cat.combustibles)),
                    title: { text: 'Tipo de Combustible' },
                    labels: { rotation: -45 }
                },
                yAxis: {
                    min: 0,
                    title: { text: 'Poder Calorífico (MJ/kg)' },
                    plotLines: [{
                        value: 42.7,
                        color: '#000',
                        dashStyle: 'Dash',
                        width: 2,
                        label: {
                            text: 'Petróleo Crudo (42.7 MJ/kg)',
                            align: 'right'
                        }
                    }]
                },
                tooltip: {
                    pointFormat: '<b>{point.y} MJ/kg</b><br/>Factor BPE: <b>{point.bpe}</b>',
                    shared: false
                },
                plotOptions: {
                    column: {
                        pointPadding: 0.2,
                        borderWidth: 0,
                        dataLabels: {
                            enabled: true,
                            format: '{point.y}'
                        }
                    },
                    bar: {
                        dataLabels: {
                            enabled: true
                        }
                    }
                },
                legend: {
                    enabled: false
                },
                series: [{
                    name: 'Poder Calorífico',
                    data: [
                        { y: 44.0, color: '#dc3545', bpe: '0.840' },
                        { y: 45.5, color: '#dc3545', bpe: '0.851' },
                        { y: 40.5, color: '#dc3545', bpe: '0.948' },
                        { y: 43.3, color: '#dc3545', bpe: '0.825' },
                        { y: 38.0, color: '#17a2b8', bpe: '0.178' },
                        { y: 46.1, color: '#17a2b8', bpe: '0.827' },
                        { y: 49.5, color: '#17a2b8', bpe: '0.140' },
                        { y: 24.0, color: '#6c757d', bpe: '0.405' },
                        { y: 32.0, color: '#6c757d', bpe: '0.540' },
                        { y: 26.8, color: '#28a745', bpe: '0.511' },
                        { y: 37.8, color: '#28a745', bpe: '0.705' },
                        { y: 15.0, color: '#28a745', bpe: '0.253' },
                        { y: 23.0, color: '#28a745', bpe: '0.109' },
                        { y: 120.0, color: '#ffc107', bpe: '0.057' }
                    ],
                    colorByPoint: true
                }],
                exporting: {
                    enabled: true,
                    buttons: {
                        contextButton: {
                            menuItems: ['viewFullscreen', 'separator', 'downloadPNG', 'downloadJPEG', 'downloadPDF', 'downloadSVG', 'separator', 'downloadCSV', 'downloadXLS']
                        }
                    }
                },
                credits: {
                    text: 'SNIEr - SENER | Fuentes: CONUEE, DOF, SIE',
                    href: 'javascript:void(0)',
                    style: {
                        cursor: 'pointer'
                    }
                }
            });

            // Agregar evento click a los créditos para abrir modal de fuentes
            $('#graficoCombustibles').on('click', '.highcharts-credits', function () {
                $('#modalFuentes').modal('show');
            });
        }

        function toggleGraficoTipo() {
            tipoGrafico = tipoGrafico === 'column' ? 'bar' : 'column';
            crearGraficoComparativo();
        }

        function calcularEquivalencia() {
            const select = document.getElementById('selectCombustible');
            const cantidad = parseFloat(document.getElementById('inputCantidad').value);
            const resultado = document.getElementById('resultadoCalculadora');

            if (!select.value || !cantidad || cantidad <= 0) {
                resultado.innerHTML = '<div class="text-warning"><i class="fas fa-exclamation-triangle me-2"></i>Seleccione combustible y cantidad válida</div>';
                return;
            }

            const [poderCalorifico, factorBPE, unidad] = select.value.split('|');
            const combustible = select.options[select.selectedIndex].text;
            const equivalenciaBPE = (cantidad * parseFloat(factorBPE)).toFixed(3);
            const energiaTotal = (cantidad * parseFloat(poderCalorifico)).toFixed(2);

            resultado.innerHTML = `
                <div class="text-success">
                    <div class="mb-2">
                        <i class="fas fa-calculator me-2"></i>
                        <strong>${cantidad} ${unidad}</strong> de <strong>${combustible}</strong>
                    </div>
                    <div class="border-top pt-2">
                        <div><i class="fas fa-oil-can me-2"></i>Equivale a: <strong class="text-primary">${equivalenciaBPE} BPE</strong></div>
                        <div><i class="fas fa-bolt me-2"></i>Energía total: <strong class="text-primary">${energiaTotal} MJ</strong></div>
                    </div>
                </div>
            `;
        }

        // Actualizar unidad física cuando cambia la selección
        document.getElementById('selectCombustible').addEventListener('change', function () {
            const unidadSpan = document.getElementById('unidadFisica');
            if (this.value) {
                const unidad = this.value.split('|')[2];
                unidadSpan.textContent = unidad;
            } else {
                unidadSpan.textContent = 'Unidad';
            }
            document.getElementById('resultadoCalculadora').innerHTML = '<div class="text-muted"><i class="fas fa-arrow-up me-2"></i>Ingrese cantidad y calcule</div>';
        });
    </script>
    }

    <style>
        /* =====================================================
   CORRECCIONES ESPECÍFICAS PARA TABLA DE COMBUSTIBLES
   ===================================================== */

        /* Tabla principal de factores */
        #tablaFactoresEquivalencia {
            font-size: 0.85rem;
            width: 100%;
        }

        /* Corrección del problema de texto cortado */
        #tablaFactoresEquivalencia td,
        #tablaFactoresEquivalencia th {
            white-space: normal !important;
            /* ✅ Permite ajuste de texto multilínea */
            word-wrap: break-word !important;
            /* ✅ Rompe palabras largas */
            word-break: normal;
            /* ✅ Rompe palabras de forma inteligente */
            vertical-align: middle;
            /* ✅ Alineación vertical centrada */
            padding: 0.5rem 0.75rem;
            /* ✅ Padding óptimo */
            max-width: 200px;
            /* ✅ Evita celdas demasiado anchas */
        }

        /* Headers con anchos flexibles */
        #tablaFactoresEquivalencia th {
            min-width: 100px;
            /* ✅ Más flexible que los 200px originales */
            font-weight: 600;
            background-color: #343a40 !important;
            color: #ffffff !important;
        }

        /* Estilos específicos para columnas */
        #tablaFactoresEquivalencia th:nth-child(1) {
            min-width: 180px;
        }

        /* Combustible */
        #tablaFactoresEquivalencia th:nth-child(2) {
            min-width: 120px;
        }

        /* Poder Calorífico */
        #tablaFactoresEquivalencia th:nth-child(3) {
            min-width: 120px;
        }

        /* Factor BPE */
        #tablaFactoresEquivalencia th:nth-child(4) {
            min-width: 100px;
        }

        /* Unidad Física */
        #tablaFactoresEquivalencia th:nth-child(5) {
            min-width: 100px;
        }

        /* Categoría */
        #tablaFactoresEquivalencia th:nth-child(6) {
            min-width: 90px;
        }

        /* Referencia */

        /* Badges mantienen nowrap para diseño compacto */
        #tablaFactoresEquivalencia .badge {
            font-size: 0.7rem;
            white-space: nowrap;
            /* ✅ Solo badges mantienen nowrap */
            padding: 0.25rem 0.5rem;
        }

        /* Iconos en tooltips */
        #tablaFactoresEquivalencia .fas {
            cursor: help;
        }

        /* Filas de categorías */
        #tablaFactoresEquivalencia .table-secondary {
            background-color: #e9ecef !important;
            font-weight: 600;
            position: sticky;
            z-index: 1;
        }

        /* Efectos hover para usabilidad */
        #tablaFactoresEquivalencia tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.1) !important;
            transition: background-color 0.2s ease;
        }

        /* =====================================================
   RESPONSIVE DESIGN PARA DISPOSITIVOS MÓVILES
   ===================================================== */

        /* Tablet y móviles grandes */
        @@media (max-width: 992px) {
            #tablaFactoresEquivalencia {
                font-size: 0.8rem;
            }

            #tablaFactoresEquivalencia th,
            #tablaFactoresEquivalencia td {
                padding: 0.4rem 0.6rem;
                max-width: 150px;
            }
        }

        /* Móviles */
        @@media (max-width: 768px) {
            #tablaFactoresEquivalencia {
                font-size: 0.75rem;
            }

            #tablaFactoresEquivalencia th,
            #tablaFactoresEquivalencia td {
                padding: 0.25rem 0.5rem;
                max-width: 120px;
                min-width: 80px;
            }

            #tablaFactoresEquivalencia .badge {
                font-size: 0.65rem;
                padding: 0.2rem 0.4rem;
            }

            /* Ocultar columna de referencia en móviles muy pequeños */
            #tablaFactoresEquivalencia th:nth-child(6),
            #tablaFactoresEquivalencia td:nth-child(6) {
                display: none;
            }
        }

        /* Móviles muy pequeños */
        @@media (max-width: 576px) {
            #tablaFactoresEquivalencia {
                font-size: 0.7rem;
            }

            #tablaFactoresEquivalencia th,
            #tablaFactoresEquivalencia td {
                padding: 0.2rem 0.3rem;
                max-width: 100px;
                min-width: 70px;
            }

            /* Simplificar headers en móviles pequeños */
            #tablaFactoresEquivalencia th small {
                display: none;
            }
        }

        /* =====================================================
   MEJORAS DE ACCESIBILIDAD Y USABILIDAD
   ===================================================== */

        /* Scroll horizontal suave */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Focus visible para navegación por teclado */
        #tablaFactoresEquivalencia th:focus,
        #tablaFactoresEquivalencia td:focus {
            outline: 2px solid #007bff;
            outline-offset: -2px;
        }

        /* Mejora del contraste para badges */
        .badge.bg-danger {
            background-color: #dc3545 !important;
        }

        .badge.bg-info {
            background-color: #17a2b8 !important;
        }

        .badge.bg-secondary {
            background-color: #6c757d !important;
        }

        .badge.bg-success {
            background-color: #28a745 !important;
        }

        .badge.bg-warning {
            background-color: #ffc107 !important;
            color: #212529 !important;
        }

        .badge.bg-primary {
            background-color: #007bff !important;
        }

        .badge.bg-dark {
            background-color: #343a40 !important;
        }

        /* Campo de búsqueda mejorado */
        #buscarCombustible {
            border: 2px solid #e9ecef;
            border-radius: 0.5rem;
            transition: border-color 0.2s ease;
        }

        #buscarCombustible:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        /* =====================================================
   PRINT STYLES PARA IMPRESIÓN
   ===================================================== */

        @@media print {
            #tablaFactoresEquivalencia {
                font-size: 10px;
                page-break-inside: avoid;
            }

            #tablaFactoresEquivalencia th,
            #tablaFactoresEquivalencia td {
                padding: 4px 6px;
                border: 1px solid #000 !important;
                background-color: #fff !important;
                color: #000 !important;
            }

            #tablaFactoresEquivalencia .table-secondary {
                background-color: #f5f5f5 !important;
            }

            /* Ocultar elementos no necesarios en impresión */
            .btn-group,
            #buscarCombustible,
            .card-header .btn {
                display: none !important;
            }
        }
    </style>