@model dynamic
@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json
@inject IHttpContextAccessor HttpContextAccessor

@{
ViewData["Title"] = "Ahorros por Medidas de Reducci√≥n en Intensidad Energ√©tica - SNIER";
var httpContext = HttpContextAccessor.HttpContext;
var perfilUsuarioJson = httpContext.Session.GetString("PerfilUsuario");
var perfilUsuario = JsonConvert.DeserializeObject<PerfilUsuario>(perfilUsuarioJson);

    var header = new HeaderViewModel
    {
    Title = "Ahorros por Medidas de Reducci√≥n en Intensidad Energ√©tica",
    IconPath = "conding.png",
    Description = @"Repositorio centralizado de ahorros energ√©ticos generados por medidas de reducci√≥n en intensidad
    energ√©tica conforme a los acuerdos celebrados y supervisados por CONUEE.",
    Section = "üí° SNIEr - Eficiencia Energ√©tica",
    ModuleInfo = JsonConvert.SerializeObject(new
    {
    title = "Ahorros Energ√©ticos por Medidas de Reducci√≥n",
    description = @"Integraci√≥n y publicaci√≥n de resultados econ√≥micos y energ√©ticos obtenidos por implementaci√≥n de
    medidas de eficiencia energ√©tica seg√∫n marco normativo nacional.",
    functionality = @"Monitoreo, an√°lisis y transparencia de ahorros derivados de acuerdos y programas de eficiencia
    energ√©tica con metodolog√≠as aprobadas por el Consejo de Planeaci√≥n Energ√©tica.",
    stage = "Consulta Oficial CONUEE",
    roles = new[] {
    new { icon = "balance-scale", text = "CONUEE: Integraci√≥n y Publicaci√≥n Oficial" },
    new { icon = "industry", text = "Entidades P√∫blicas y Privadas: Reporte" },
    new { icon = "oil-well", text = "PEMEX, CFE: Provisi√≥n de Datos" },
    new { icon = "chart-line", text = "Usuarios Alto Consumo: Contribuci√≥n" }
    },
    order = new { step = 1, description = "Consulta de registros oficiales SNIE-CONUEE" }
    })
    };
    }

    @await Html.PartialAsync("_ViewHeader", header)

    <!-- Marco Normativo y Contexto CONUEE -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-down">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-gradient text-white"
                style="background: linear-gradient(135deg, #189c90 0%, #294a95 100%);">
                <h5 class="mb-0">
                    <i class="fas fa-balance-scale me-2"></i>
                    Marco Normativo y Responsabilidades CONUEE
                    <button class="btn btn-sm btn-outline-light float-end" type="button" data-bs-toggle="collapse"
                        data-bs-target="#marcoNormativo">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </h5>
            </div>
            <div class="collapse show" id="marcoNormativo">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-8">
                            <h6 class="text-primary fw-bold mb-3">
                                <i class="fas fa-institution me-2"></i>
                                Responsabilidad de Integraci√≥n y Publicaci√≥n (Art. 66-68)
                            </h6>
                            <p class="mb-3">
                                La <strong>Comisi√≥n Nacional para el Uso Eficiente de la Energ√≠a (CONUEE)</strong> es la
                                entidad responsable de integrar y publicar los registros de informaci√≥n sobre las
                                <strong>medidas de reducci√≥n en intensidad energ√©tica</strong> y los <strong>ahorros
                                    energ√©ticos y econ√≥micos obtenidos por su implementaci√≥n</strong> derivados de
                                acuerdos
                                celebrados en la materia.
                            </p>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Art. 66.III:</strong> Integraci√≥n SNIE con mayor desagregaci√≥n posible
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Art. 67-68:</strong> Entidades obligadas a proporcionar datos
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Art. 85:</strong> Ahorros derivados de acuerdos espec√≠ficos
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Art. 84-86:</strong> Metodolog√≠as aprobadas por Consejo
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Art. 114:</strong> Factores para determinaci√≥n de equivalencias
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>PLATEASE:</strong> Escenarios de ahorro de energ√≠a
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="alert alert-info border-0 shadow-sm">
                                <h6 class="alert-heading">
                                    <i class="fas fa-users me-2"></i>
                                    Entidades Contribuyentes de Informaci√≥n
                                </h6>
                                <small>
                                    ‚Ä¢ <strong>Dependencias y Entidades APF</strong> (Art. 67.I)<br>
                                    ‚Ä¢ <strong>Entidades Federativas y Municipios</strong><br>
                                    ‚Ä¢ <strong>Usuarios con Patr√≥n de Alto Consumo</strong> (Art. 67.II)<br>
                                    ‚Ä¢ <strong>PEMEX y CFE</strong> (Art. 68.III)<br>
                                    ‚Ä¢ <strong>Suministradores y Usuarios Calificados</strong><br>
                                    ‚Ä¢ <strong>Participantes del Mercado El√©ctrico Mayorista</strong><br>
                                    ‚Ä¢ <strong>Otros organismos con registros relacionados</strong>
                                </small>
                                <hr>
                                <h6 class="text-primary mb-2">
                                    <i class="fas fa-balance-scale me-1"></i>
                                    Marco Metodol√≥gico:
                                </h6>
                                <small class="text-muted">
                                    Metodolog√≠as para cuantificar beneficios energ√©ticos y econ√≥micos sometidas a
                                    opini√≥n del
                                    <strong>Consejo de Planeaci√≥n Energ√©tica</strong> conforme a los art√≠culos 84 y
                                    86.III.
                                </small>
                                ‚Ä¢ <strong>Suministradores y Usuarios Calificados</strong><br>
                                ‚Ä¢ <strong>Participantes del Mercado El√©ctrico</strong>
                                </small>
                                <hr>
                                <div class="mt-3">
                                    <h6 class="text-primary mb-2">
                                        <i class="fas fa-link me-1"></i>
                                        Enlaces Oficiales:
                                    </h6>
                                    <div class="d-grid gap-1">
                                        <a href="https://www.gob.mx/conuee" target="_blank"
                                            class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>CONUEE
                                        </a>
                                        <a href="https://www.gob.mx/sener" target="_blank"
                                            class="btn btn-outline-secondary btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i>SENER
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- KPIs Principales de Ahorros por Medidas de Reducci√≥n en Intensidad Energ√©tica -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-up">
        <div class="row g-4">
            <!-- Ahorros Totales por Reducci√≥n de Intensidad -->
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 shadow-sm border-0"
                    style="background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%); border-left: 4px solid #28a745 !important;">
                    <div class="card-body text-dark">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-chart-line-down fa-2x me-3" style="color: #28a745;"></i>
                            <div>
                                <h6 class="card-title text-uppercase fw-bold mb-0" style="color: #155724;">Ahorros por
                                    Reducci√≥n</h6>
                                <p class="small mb-0" style="color: #6c757d;">Intensidad Energ√©tica</p>
                                <h4 class="mb-0 mt-2" style="color: #155724;">1,247.3 PJ</h4>
                                <small class="text-success">‚Üó +12.5% respecto a√±o anterior</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medidas Implementadas -->
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 shadow-sm border-0"
                    style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); border-left: 4px solid #ffc107 !important;">
                    <div class="card-body text-dark">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-tools fa-2x me-3" style="color: #856404;"></i>
                            <div>
                                <h6 class="card-title text-uppercase fw-bold mb-0" style="color: #856404;">Medidas
                                    Activas</h6>
                                <p class="small mb-0" style="color: #6c757d;">Acuerdos Vigentes</p>
                                <h4 class="mb-0 mt-2" style="color: #856404;">2,847</h4>
                                <small class="text-warning">En 487 entidades</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Equivalente en BPE -->
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 shadow-sm border-0"
                    style="background: linear-gradient(135deg, #e7f3ff 0%, #cce7ff 100%); border-left: 4px solid #007bff !important;">
                    <div class="card-body text-dark">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-oil-can fa-2x me-3" style="color: #007bff;"></i>
                            <div>
                                <h6 class="card-title text-uppercase fw-bold mb-0" style="color: #004085;">Equivalente
                                    BPE</h6>
                                <p class="small mb-0" style="color: #6c757d;">Factor de Conversi√≥n</p>
                                <h4 class="mb-0 mt-2" style="color: #004085;">203.8 M</h4>
                                <small class="text-primary">Factor CONUEE 2024</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ahorro Econ√≥mico Consolidado -->
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 shadow-sm border-0"
                    style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); border-left: 4px solid #ffc107 !important;">
                    <div class="card-body text-dark">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-dollar-sign fa-2x me-3" style="color: #856404;"></i>
                            <div>
                                <h6 class="card-title text-uppercase fw-bold mb-0" style="color: #856404;">Beneficio
                                    Econ√≥mico</h6>
                                <p class="small mb-0" style="color: #6c757d;">Por Medidas de Reducci√≥n</p>
                                <h4 class="mb-0 mt-2" style="color: #856404;">$42,536 MDP</h4>
                                <small class="text-warning">Metodolog√≠a Art. 86.III</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medidas Activas -->
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 shadow-sm border-0"
                    style="background: linear-gradient(135deg, #fce8e6 0%, #f8d7da 100%); border-left: 4px solid #dc3545 !important;">
                    <div class="card-body text-dark">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-cogs fa-2x me-3" style="color: #dc3545;"></i>
                            <div>
                                <h6 class="card-title text-uppercase fw-bold mb-0" style="color: #721c24;">Medidas
                                    Activas</h6>
                                <p class="small mb-0" style="color: #6c757d;">Programas Vigentes</p>
                                <h4 class="mb-0 mt-2" style="color: #721c24;">148</h4>
                                <small class="text-danger">En seguimiento CONUEE</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gr√°fico Principal de Tendencias de Ahorros por Medidas de Reducci√≥n -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-up">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-gradient text-white"
                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        Evoluci√≥n Temporal de Ahorros por Medidas de Reducci√≥n en Intensidad Energ√©tica
                    </h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarPeriodo('anual')"
                            data-bs-toggle="tooltip" title="Vista Anual">
                            <i class="fas fa-calendar-alt"></i> Anual
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-light"
                            onclick="cambiarPeriodo('trimestral')" data-bs-toggle="tooltip" title="Vista Trimestral">
                            <i class="fas fa-calendar"></i> Trimestral
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="graficoTendenciaAhorros" style="height: 500px;"></div>
            </div>
            <div class="card-footer bg-light">
                <div class="row text-center">
                    <div class="col-md-4">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            <strong>Base:</strong> Metodolog√≠as aprobadas Consejo de Planeaci√≥n (Art. 84-86)
                        </small>
                    </div>
                    <div class="col-md-4">
                        <small class="text-muted">
                            <i class="fas fa-update me-1"></i>
                            <strong>Actualizaci√≥n:</strong> CONUEE - Mensual
                        </small>
                    </div>
                    <div class="col-md-4">
                        <small class="text-muted">
                            <i class="fas fa-chart-bar me-1"></i>
                            <strong>Unidades:</strong> Petajulios (PJ) / Equivalente BPE
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Desglose de Ahorros por Medidas de Reducci√≥n en Intensidad Energ√©tica -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-up">
        <div class="row g-4">
            <!-- Desglose por Tipo de Medida de Reducci√≥n -->
            <div class="col-lg-6">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-header bg-gradient text-white"
                        style="background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%); color: #155724 !important; border-bottom: 3px solid #28a745;">
                        <h6 class="mb-0" style="color: #155724 !important;">
                            <i class="fas fa-tools me-2" style="color: #28a745;"></i>
                            Ahorros por Tipo de Medida de Reducci√≥n (Art. 85)
                        </h6>
                    </div>
                    <div class="card-body">
                        <div id="graficoTipoMedida" style="height: 350px;"></div>
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                <strong>Categor√≠as:</strong> Eficiencia en edificaci√≥n, procesos industriales,
                                transporte, programas espec√≠ficos y acuerdos voluntarios
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Desglose por Entidad Contribuyente -->
            <div class="col-lg-6">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-header bg-gradient text-white"
                        style="background: linear-gradient(135deg, #e7f3ff 0%, #cce7ff 100%); color: #004085 !important; border-bottom: 3px solid #007bff;">
                        <h6 class="mb-0" style="color: #004085 !important;">
                            <i class="fas fa-building me-2" style="color: #007bff;"></i>
                            Ahorros por Entidad Contribuyente (Art. 67-68)
                        </h6>
                    </div>
                    <div class="card-body">
                        <div id="graficoSector" style="height: 350px;"></div>
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                <strong>Fuentes:</strong> APF, Alto Consumo, PEMEX, CFE, Suministradores, Usuarios
                                Calificados, MEM
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparativo Resultados Energ√©ticos vs Econ√≥micos -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-up">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-gradient text-white"
                style="background: linear-gradient(135deg, #fce8e6 0%, #f8d7da 100%); color: #721c24 !important; border-bottom: 3px solid #dc3545;">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0" style="color: #721c24 !important;">
                        <i class="fas fa-balance-scale me-2" style="color: #dc3545;"></i>
                        Comparativo: Resultados Energ√©ticos vs Econ√≥micos (Art. 86.III)
                    </h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm" style="color: #721c24; border-color: #721c24;"
                            onclick="toggleVistaComparativo()" data-bs-toggle="tooltip" title="Cambiar vista">
                            <i class="fas fa-exchange-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="graficoComparativo" style="height: 400px;"></div>
            </div>
            <div class="card-footer bg-light">
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fas fa-bolt text-success fs-4"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">Ahorro Energ√©tico Total</h6>
                                <strong class="text-success">1,247.3 PJ</strong>
                                <small class="text-muted d-block">Equivalente a 203.8 M BPE</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fas fa-dollar-sign text-warning fs-4"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">Beneficio Econ√≥mico Total</h6>
                                <strong class="text-warning">$42,536 MDP</strong>
                                <small class="text-muted d-block">Ahorro directo medido</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros y Controles Interactivos para Ahorros por Medidas de Reducci√≥n -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-up">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fas fa-filter me-2 text-primary"></i>
                    Filtros de Consulta y An√°lisis - Marco Normativo CONUEE
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <!-- Filtro Temporal -->
                    <div class="col-lg-3 col-md-6">
                        <label class="form-label fw-bold">Per√≠odo de Consulta:</label>
                        <select class="form-select" id="filtroTiempo" onchange="aplicarFiltros()">
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021-2024">2021-2024 (Acumulado)</option>
                            <option value="historico">Hist√≥rico Completo</option>
                        </select>
                    </div>

                    <!-- Filtro Geogr√°fico -->
                    <div class="col-lg-3 col-md-6">
                        <label class="form-label fw-bold">Desagregaci√≥n Geogr√°fica:</label>
                        <select class="form-select" id="filtroGeografia" onchange="aplicarFiltros()">
                            <option value="nacional">Nacional Consolidado</option>
                            <option value="regional">Por Regi√≥n SENER</option>
                            <option value="estatal">Por Entidad Federativa</option>
                            <option value="municipal">Por Municipio (disponible)</option>
                        </select>
                    </div>

                    <!-- Filtro por Entidad Contribuyente (Art. 67-68) -->
                    <div class="col-lg-3 col-md-6">
                        <label class="form-label fw-bold">Entidad Contribuyente (Art. 67-68):</label>
                        <select class="form-select" id="filtroEntidad" onchange="aplicarFiltros()">
                            <option value="todas">Todas las Entidades</option>
                            <option value="apf">Dependencias APF (Art. 67.I)</option>
                            <option value="entidades-fed">Entidades Federativas</option>
                            <option value="municipios">Municipios</option>
                            <option value="alto-consumo">Patr√≥n Alto Consumo (Art. 67.II)</option>
                            <option value="pemex">PEMEX (Art. 68.III)</option>
                            <option value="cfe">CFE (Art. 68.III)</option>
                            <option value="suministradores">Suministradores</option>
                            <option value="usuarios-calificados">Usuarios Calificados</option>
                            <option value="mem">Participantes MEM</option>
                        </select>
                    </div>

                    <!-- Bot√≥n de Exportaci√≥n -->
                    <div class="col-lg-3 col-md-6 d-flex align-items-end">
                        <div class="btn-group w-100" role="group">
                            <button type="button" class="btn btn-primary" onclick="exportarDatos('excel')"
                                data-bs-toggle="tooltip" title="Exportar a Excel">
                                <i class="fas fa-file-excel me-1"></i>Excel
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="exportarDatos('pdf')"
                                data-bs-toggle="tooltip" title="Exportar a PDF">
                                <i class="fas fa-file-pdf me-1"></i>PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla Detallada de Medidas de Reducci√≥n en Intensidad Energ√©tica -->
    <div class="container-fluid px-5 mb-4" data-aos="fade-up">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-gradient text-white"
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-table me-2"></i>
                        Registro Oficial de Medidas de Reducci√≥n en Intensidad Energ√©tica (CONUEE)
                    </h5>
                    <div class="d-flex align-items-center gap-2">
                        <div class="input-group" style="width: 250px;">
                            <span class="input-group-text bg-white">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" class="form-control" id="buscarMedida"
                                placeholder="Buscar medida o entidad...">
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-light" data-bs-toggle="modal"
                            data-bs-target="#modalMetodologia" data-bs-toggle="tooltip"
                            title="Ver metodolog√≠as Art. 86.III">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table id="tablaMedidasDetalle" class="table table-striped table-hover mb-0">
                        <thead class="table-dark sticky-top">
                            <tr>
                                <th style="min-width: 200px;">
                                    <i class="fas fa-tools me-2"></i>Medida de Reducci√≥n
                                </th>
                                <th class="text-center" style="min-width: 120px;">
                                    <i class="fas fa-chart-line-down me-2"></i>Ahorro Energ√©tico<br>
                                    <small class="text-muted">(PJ)</small>
                                </th>
                                <th class="text-center" style="min-width: 120px;">
                                    <i class="fas fa-oil-can me-2"></i>Equivalente BPE<br>
                                    <small class="text-muted">(Millones)</small>
                                </th>
                                <th class="text-center" style="min-width: 120px;">
                                    <i class="fas fa-dollar-sign me-2"></i>Beneficio Econ√≥mico<br>
                                    <small class="text-muted">(MDP)</small>
                                </th>
                                <th class="text-center" style="min-width: 150px;">
                                    <i class="fas fa-building me-2"></i>Entidad Contribuyente<br>
                                    <small class="text-muted">(Art. 67-68)</small>
                                </th>
                                <th class="text-center" style="min-width: 100px;">
                                    <i class="fas fa-calendar me-2"></i>Per√≠odo
                                </th>
                                <th class="text-center" style="min-width: 120px;">
                                    <i class="fas fa-handshake me-2"></i>Tipo Acuerdo
                                </th>
                                <th class="text-center" style="min-width: 100px;">
                                    <i class="fas fa-info-circle me-2"></i>Estado
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Medidas de Edificaci√≥n -->
                            <tr class="table-secondary">
                                <td colspan="7" class="fw-bold text-center">
                                    <i class="fas fa-building me-2"></i>MEDIDAS DE EFICIENCIA EN EDIFICACI√ìN
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success me-2">Edificaci√≥n</span>Programa Nacional de
                                    Iluminaci√≥n LED</td>
                                <td class="text-center">285.4</td>
                                <td class="text-center fw-bold text-primary">46.6</td>
                                <td class="text-center">$12,450</td>
                                <td class="text-center"><span class="badge bg-primary">CONUEE-APF</span></td>
                                <td class="text-center">2022-2024</td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="Vigente"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success me-2">Edificaci√≥n</span>Norma NOM-008-ENER (HVAC
                                    Eficiente)</td>
                                <td class="text-center">156.7</td>
                                <td class="text-center fw-bold text-primary">25.6</td>
                                <td class="text-center">$6,890</td>
                                <td class="text-center"><span class="badge bg-primary">CONUEE</span></td>
                                <td class="text-center">2023-2024</td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="Vigente"></i></td>
                            </tr>

                            <!-- Medidas Industriales -->
                            <tr class="table-secondary">
                                <td colspan="7" class="fw-bold text-center">
                                    <i class="fas fa-industry me-2"></i>MEDIDAS EN PROCESOS INDUSTRIALES
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info me-2">Industrial</span>Acuerdos Voluntarios Industria
                                    Intensiva</td>
                                <td class="text-center">398.2</td>
                                <td class="text-center fw-bold text-primary">65.1</td>
                                <td class="text-center">$15,670</td>
                                <td class="text-center"><span class="badge bg-warning">Alto Consumo</span></td>
                                <td class="text-center">2021-2024</td>
                                <td class="text-center"><i class="fas fa-sync text-primary" data-bs-toggle="tooltip"
                                        title="Renovaci√≥n"></i></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info me-2">Industrial</span>Cogeneraci√≥n CFE-Privados</td>
                                <td class="text-center">267.8</td>
                                <td class="text-center fw-bold text-primary">43.8</td>
                                <td class="text-center">$4,920</td>
                                <td class="text-center"><span class="badge bg-danger">CFE</span></td>
                                <td class="text-center">2022-2024</td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="Vigente"></i></td>
                            </tr>

                            <!-- Medidas de Transporte -->
                            <tr class="table-secondary">
                                <td colspan="7" class="fw-bold text-center">
                                    <i class="fas fa-truck me-2"></i>MEDIDAS EN TRANSPORTE
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-secondary me-2">Transporte</span>Renovaci√≥n Flota Transporte
                                    P√∫blico</td>
                                <td class="text-center">89.3</td>
                                <td class="text-center fw-bold text-primary">14.6</td>
                                <td class="text-center">$2,100</td>
                                <td class="text-center"><span class="badge bg-success">Estados-Municipios</span></td>
                                <td class="text-center">2023-2024</td>
                                <td class="text-center"><i class="fas fa-play text-warning" data-bs-toggle="tooltip"
                                        title="En implementaci√≥n"></i></td>
                            </tr>

                            <!-- Programas Espec√≠ficos -->
                            <tr class="table-secondary">
                                <td colspan="7" class="fw-bold text-center">
                                    <i class="fas fa-handshake me-2"></i>PROGRAMAS ESPEC√çFICOS Y ACUERDOS
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-dark me-2">Programa</span>PEMEX - Refinaci√≥n Eficiente</td>
                                <td class="text-center">49.9</td>
                                <td class="text-center fw-bold text-primary">8.2</td>
                                <td class="text-center">$606</td>
                                <td class="text-center"><span class="badge bg-danger">PEMEX</span></td>
                                <td class="text-center">2024</td>
                                <td class="text-center"><i class="fas fa-check text-success" data-bs-toggle="tooltip"
                                        title="Completado"></i></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-light">
                <div class="row text-center">
                    <div class="col-md-3">
                        <small class="text-muted">
                            <i class="fas fa-database me-1"></i>
                            <strong>Medidas Registradas:</strong> 148
                        </small>
                    </div>
                    <div class="col-md-3">
                        <small class="text-muted">
                            <i class="fas fa-calendar me-1"></i>
                            <strong>Per√≠odo:</strong> 2021-2024
                        </small>
                    </div>
                    <div class="col-md-3">
                        <small class="text-muted">
                            <i class="fas fa-balance-scale me-1"></i>
                            <strong>Metodolog√≠a:</strong> CONUEE Aprobada
                        </small>
                    </div>
                    <div class="col-md-3">
                        <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                            data-bs-target="#modalFuentesAhorros">
                            <i class="fas fa-book me-1"></i>
                            <strong>Ver Fuentes</strong>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Metodolog√≠as para Ahorros por Medidas de Reducci√≥n -->
    <div class="modal fade" id="modalMetodologia" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-flask me-2"></i>
                        Metodolog√≠as para Cuantificaci√≥n de Ahorros por Medidas de Reducci√≥n (Art. 86.III)
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 class="text-primary mb-3"><i class="fas fa-balance-scale me-2"></i>Marco Normativo CONUEE</h6>

                    <div class="accordion" id="accordionMetodologia">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseMetod1">
                                    <i class="fas fa-gavel me-2"></i>Art. 86.III - Metodolog√≠as Aprobadas por Consejo
                                </button>
                            </h2>
                            <div id="collapseMetod1" class="accordion-collapse collapse show"
                                data-bs-parent="#accordionMetodologia">
                                <div class="accordion-body">
                                    La <strong>Secretar√≠a, CNE y CONUEE</strong> deben someter a la opini√≥n del
                                    <strong>Consejo
                                        de Planeaci√≥n Energ√©tica</strong> las metodolog√≠as para cuantificar los
                                    <strong>beneficios
                                        energ√©ticos y econ√≥micos</strong> derivados de las medidas de reducci√≥n en
                                    intensidad energ√©tica.
                                    La Secretar√≠a puede solicitar informaci√≥n necesaria para el c√°lculo de valores y
                                    factores.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseMetod2">
                                    <i class="fas fa-handshake me-2"></i>Art. 85 - Ahorros Derivados de Acuerdos
                                </button>
                            </h2>
                            <div id="collapseMetod2" class="accordion-collapse collapse"
                                data-bs-parent="#accordionMetodologia">
                                <div class="accordion-body">
                                    Los ahorros registrados se derivan espec√≠ficamente de los <strong>acuerdos
                                        celebrados
                                        en materia de reducci√≥n de intensidad energ√©tica</strong>. Estos forman parte de
                                    los
                                    escenarios de ahorro que integran el SNIE y los escenarios prospectivos del sector
                                    energ√©tico.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseMetod3">
                                    <i class="fas fa-calculator me-2"></i>Art. 114 - Factores de Equivalencia Energ√©tica
                                </button>
                            </h2>
                            <div id="collapseMetod3" class="accordion-collapse collapse"
                                data-bs-parent="#accordionMetodologia">
                                <div class="accordion-body">
                                    Utilizaci√≥n de <strong>factores oficiales CONUEE</strong> para determinar
                                    equivalencias
                                    de combustibles y conversi√≥n a unidades estandarizadas (BPE, PJ), garantizando
                                    consistencia en la cuantificaci√≥n de ahorros a nivel nacional.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseMetod4">
                                    <i class="fas fa-globe me-2"></i>Art. 66.VI - Escenarios Prospectivos
                                </button>
                            </h2>
                            <div id="collapseMetod4" class="accordion-collapse collapse"
                                data-bs-parent="#accordionMetodologia">
                                <div class="accordion-body">
                                    Los ahorros por medidas de reducci√≥n forman parte de los <strong>escenarios de
                                        ahorro
                                        de energ√≠a</strong> que deben integrar el escenario de referencia y los
                                    escenarios
                                    prospectivos del sector energ√©tico a mediano y largo plazo del SNIE.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Fuentes y Entidades Contribuyentes -->
    <div class="modal fade" id="modalFuentesAhorros" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-book me-2"></i>
                        Entidades Contribuyentes de Informaci√≥n - Medidas de Reducci√≥n (Art. 67-68)
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Entidades Contribuyentes Art. 67-68 -->
                        <div class="col-lg-6">
                            <h6 class="text-primary fw-bold mb-3">
                                <i class="fas fa-users me-2"></i>Entidades Obligadas a Proporcionar Informaci√≥n
                            </h6>

                            <div class="card mb-3 border-success">
                                <div class="card-header bg-light">
                                    <strong><i class="fas fa-institution me-2 text-success"></i>Art. 67.I -
                                        Administraci√≥n P√∫blica Federal</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small mb-2">Dependencias y entidades de la APF, entidades federativas,
                                        municipios y otros organismos p√∫blicos que implementan medidas de reducci√≥n.</p>
                                    <div class="d-flex gap-2 flex-wrap">
                                        <span class="badge bg-success">SENER</span>
                                        <span class="badge bg-success">CONUEE</span>
                                        <span class="badge bg-success">Estados</span>
                                        <span class="badge bg-success">Municipios</span>
                                    </div>
                                </div>
                            </div>

                            <div class="card mb-3 border-warning">
                                <div class="card-header bg-light">
                                    <strong><i class="fas fa-industry me-2 text-warning"></i>Art. 67.II - Usuarios con
                                        Patr√≥n de Alto Consumo</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small mb-2">Usuarios industriales y comerciales con consumos energ√©ticos
                                        significativos que deben reportar medidas de reducci√≥n en intensidad energ√©tica.
                                    </p>
                                    <div class="d-flex gap-2 flex-wrap">
                                        <span class="badge bg-warning text-dark">Industria Qu√≠mica</span>
                                        <span class="badge bg-warning text-dark">Sider√∫rgica</span>
                                        <span class="badge bg-warning text-dark">Cementera</span>
                                        <span class="badge bg-warning text-dark">Petroqu√≠mica</span>
                                    </div>
                                </div>
                            </div>

                            <div class="card mb-3 border-danger">
                                <div class="card-header bg-light">
                                    <strong><i class="fas fa-oil-well me-2 text-danger"></i>Art. 68.III - EPE y
                                        Participantes del Sector</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small mb-2">Empresas Productivas del Estado, Suministradores, Usuarios
                                        Calificados,
                                        Participantes del MEM y otras personas e instituciones con registros
                                        relacionados.</p>
                                    <div class="d-flex gap-2 flex-wrap">
                                        <span class="badge bg-danger">PEMEX</span>
                                        <span class="badge bg-danger">CFE</span>
                                        <span class="badge bg-danger">Suministradores</span>
                                        <span class="badge bg-danger">Usuarios Calificados</span>
                                        <span class="badge bg-danger">Participantes MEM</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Referencias y Enlaces -->
                        <div class="col-lg-6">
                            <h6 class="text-success fw-bold mb-3">
                                <i class="fas fa-link me-2"></i>Referencias Oficiales y Enlaces
                            </h6>

                            <div class="list-group">
                                <a href="https://www.gob.mx/conuee" target="_blank"
                                    class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1"><i class="fas fa-external-link-alt me-2"></i>CONUEE - Comisi√≥n
                                            Nacional para el Uso Eficiente de la Energ√≠a</h6>
                                    </div>
                                    <p class="mb-1">Entidad responsable de integrar y publicar registros de eficiencia
                                        energ√©tica</p>
                                    <small>Metodolog√≠as, programas y resultados oficiales</small>
                                </a>

                                <a href="https://www.gob.mx/sener" target="_blank"
                                    class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1"><i class="fas fa-external-link-alt me-2"></i>SENER - Secretar√≠a
                                            de Energ√≠a</h6>
                                    </div>
                                    <p class="mb-1">Coordinaci√≥n de pol√≠ticas de eficiencia energ√©tica nacional</p>
                                    <small>PLATEASE y planeaci√≥n energ√©tica</small>
                                </a>

                                <a href="https://sie.energia.gob.mx/" target="_blank"
                                    class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1"><i class="fas fa-external-link-alt me-2"></i>SIE - Sistema de
                                            Informaci√≥n Energ√©tica</h6>
                                    </div>
                                    <p class="mb-1">Base de datos oficial del sector energ√©tico mexicano</p>
                                    <small>Estad√≠sticas y balances energ√©ticos</small>
                                </a>

                                <a href="https://dof.gob.mx/" target="_blank"
                                    class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1"><i class="fas fa-external-link-alt me-2"></i>DOF - Diario
                                            Oficial de la Federaci√≥n</h6>
                                    </div>
                                    <p class="mb-1">Publicaciones oficiales de normas y metodolog√≠as</p>
                                    <small>Marco legal y normativo</small>
                                </a>
                            </div>

                            <hr>
                            <h6 class="text-info fw-bold mb-2">
                                <i class="fas fa-file-alt me-2"></i>Normatividad Aplicable:
                            </h6>
                            <ul class="list-unstyled small">
                                <li><i class="fas fa-check text-success me-2"></i><strong>Art. 66.III:</strong>
                                    Integraci√≥n SNIE con mayor desagregaci√≥n</li>
                                <li><i class="fas fa-check text-success me-2"></i><strong>Art. 67-68:</strong>
                                    Obligaciones de entidades contribuyentes</li>
                                <li><i class="fas fa-check text-success me-2"></i><strong>Art. 84-86:</strong>
                                    Metodolog√≠as y factores de equivalencia</li>
                                <li><i class="fas fa-check text-success me-2"></i><strong>Art. 85:</strong> Ahorros
                                    derivados de acuerdos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
    <script>
        $(document).ready(function () {
            // Inicializar tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Inicializar gr√°ficos
            inicializarGraficos();

            // Configurar campo de b√∫squeda
            configurarBusqueda();
        });

        // Funciones de filtros
        function aplicarFiltros() {
            const tiempo = document.getElementById('filtroTiempo').value;
            const geografia = document.getElementById('filtroGeografia').value;
            const entidad = document.getElementById('filtroEntidad').value;

            console.log('Aplicando filtros:', { tiempo, geografia, entidad });
            // Aqu√≠ se implementar√≠a la l√≥gica para actualizar los gr√°ficos y tabla
            actualizarGraficos(tiempo, geografia, entidad);
        }

        function cambiarPeriodo(periodo) {
            console.log('Cambiando per√≠odo a:', periodo);
            // L√≥gica para cambiar vista del gr√°fico principal
        }

        function toggleVistaComparativo() {
            console.log('Cambiando vista comparativo');
            // L√≥gica para alternar entre diferentes vistas del comparativo
        }

        function exportarDatos(formato) {
            console.log('Exportando datos en formato:', formato);
            // L√≥gica para exportar datos
        }

        // Configurar b√∫squeda en tabla
        function configurarBusqueda() {
            const buscarInput = document.getElementById('buscarMedida');
            if (buscarInput) {
                buscarInput.addEventListener('input', function (e) {
                    const filtro = e.target.value.toLowerCase();
                    const filas = document.querySelectorAll('#tablaMedidasDetalle tbody tr:not(.table-secondary)');

                    filas.forEach(fila => {
                        const texto = fila.textContent.toLowerCase();
                        fila.style.display = texto.includes(filtro) ? '' : 'none';
                    });
                });
            }
        }

        // Inicializar todos los gr√°ficos
        function inicializarGraficos() {
            // Gr√°fico de tendencia principal
            Highcharts.chart('graficoTendenciaAhorros', {
                chart: { type: 'area' },
                title: { text: null },
                xAxis: {
                    categories: ['2021', '2022', '2023', '2024'],
                    crosshair: true
                },
                yAxis: {
                    title: { text: 'Ahorros (PJ)' }
                },
                tooltip: {
                    shared: true,
                    valueSuffix: ' PJ'
                },
                plotOptions: {
                    area: {
                        fillOpacity: 0.3,
                        stacking: 'normal'
                    }
                },
                series: [{
                    name: 'Edificaci√≥n',
                    data: [120, 180, 320, 442],
                    color: '#28a745'
                }, {
                    name: 'Industrial',
                    data: [200, 340, 480, 666],
                    color: '#007bff'
                }, {
                    name: 'Transporte',
                    data: [45, 60, 75, 89],
                    color: '#ffc107'
                }, {
                    name: 'Programas Espec√≠ficos',
                    data: [15, 25, 35, 50],
                    color: '#dc3545'
                }],
                credits: { enabled: false }
            });

            // Gr√°fico por tipo de medida (donut)
            Highcharts.chart('graficoTipoMedida', {
                chart: { type: 'pie' },
                title: { text: null },
                plotOptions: {
                    pie: {
                        innerSize: '60%',
                        dataLabels: {
                            format: '{point.name}: {point.percentage:.1f}%'
                        }
                    }
                },
                series: [{
                    name: 'Ahorros',
                    data: [
                        { name: 'Eficiencia en Edificaci√≥n', y: 442.1, color: '#28a745' },
                        { name: 'Procesos Industriales', y: 666.0, color: '#007bff' },
                        { name: 'Transporte', y: 89.3, color: '#ffc107' },
                        { name: 'Programas Espec√≠ficos', y: 49.9, color: '#dc3545' }
                    ]
                }],
                credits: { enabled: false }
            });

            // Gr√°fico por sector
            Highcharts.chart('graficoSector', {
                chart: { type: 'column' },
                title: { text: null },
                xAxis: {
                    categories: ['APF', 'Alto Consumo', 'CFE', 'PEMEX', 'Estados/Municipios'],
                    crosshair: true
                },
                yAxis: {
                    title: { text: 'Ahorros (PJ)' }
                },
                series: [{
                    name: 'Ahorro Energ√©tico',
                    data: [442.1, 398.2, 267.8, 49.9, 89.3],
                    color: '#189c90'
                }],
                credits: { enabled: false }
            });

            // Gr√°fico comparativo energ√©tico vs econ√≥mico
            Highcharts.chart('graficoComparativo', {
                chart: { zoomType: 'xy' },
                title: { text: null },
                xAxis: {
                    categories: ['2021', '2022', '2023', '2024'],
                    crosshair: true
                },
                yAxis: [{
                    title: { text: 'Ahorro Energ√©tico (PJ)', style: { color: '#28a745' } },
                    labels: { style: { color: '#28a745' } }
                }, {
                    title: { text: 'Ahorro Econ√≥mico (MDP)', style: { color: '#ffc107' } },
                    labels: { style: { color: '#ffc107' } },
                    opposite: true
                }],
                series: [{
                    name: 'Ahorro Energ√©tico',
                    type: 'column',
                    data: [380, 605, 910, 1247],
                    color: '#28a745'
                }, {
                    name: 'Ahorro Econ√≥mico',
                    type: 'line',
                    yAxis: 1,
                    data: [15200, 24300, 36400, 42536],
                    color: '#ffc107',
                    marker: { enabled: true }
                }],
                credits: { enabled: false }
            });
        }

        function actualizarGraficos(tiempo, geografia, entidad) {
            // L√≥gica para actualizar gr√°ficos basado en filtros
            console.log('Actualizando gr√°ficos con filtros aplicados');
        }
    </script>
    }