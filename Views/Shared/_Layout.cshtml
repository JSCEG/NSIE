@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json
@using NSIE.Models
@inject IHttpContextAccessor HttpContextAccessor

@{
    var httpContext = HttpContextAccessor.HttpContext;
    var perfilUsuarioJson = httpContext.Session.GetString("PerfilUsuario");
    var perfilUsuario = JsonConvert.DeserializeObject<PerfilUsuario>(perfilUsuarioJson);
    var seccionesUsuarioJson = httpContext.Session.GetString("SeccionesUsuario");
    var seccionesUsuario = JsonConvert.DeserializeObject<List<SeccionSNIER>>(seccionesUsuarioJson);
    ViewData["NombreUsuario"] = perfilUsuario.Nombre;
    ViewData["RolUsuario"] = perfilUsuario.Rol;
    ViewData["IDUsuario"] = perfilUsuario.IdUsuario;
    ViewData["Unidad_de_Adscripcion"] = perfilUsuario.Unidad_de_Adscripcion;
    ViewData["Mercado_ID"] = perfilUsuario.Mercado_ID;
    var currentController = ViewContext.RouteData.Values["Controller"].ToString();
    var currentAction = ViewContext.RouteData.Values["Action"].ToString();
}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <title>@ViewData["Title"] - SNIER</title>

    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" as="style">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap"rel="stylesheet">

        <link rel="stylesheet" href="~/css/portal.css" asp-append-version="true" />
        <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
        <!-- SweetAlert2 -->
        <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

        <!-- Leaflet -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

        <!-- Geovisualizador CSS -->
        <link rel="stylesheet" href="~/Geovisualizador/css/qgis2web.css">
        <link rel="stylesheet" href="~/Geovisualizador/css/fontawesome-all.min.css">
        <link rel="stylesheet" href="~/Geovisualizador/css/leaflet-control-geocoder.Geocoder.css">
        <link rel="stylesheet" href="~/Geovisualizador/css/leaflet-search.css">
        <link rel="stylesheet" href="~/Geovisualizador/css/leaflet-measure.css">
        <link rel="stylesheet" href="~/Geovisualizador/css/MarkerCluster.css">
        <link rel="stylesheet" href="~/Geovisualizador/css/MarkerCluster.Default.css">
        <link rel="stylesheet" href="~/Geovisualizador/css/leaflet.css">
        <link rel="stylesheet" href="~/Geovisualizador/css/L.Control.Layers.Tree.css">

        <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" rel="stylesheet" />
        <link rel="stylesheet" href="~/Geovisualizador/dist/leaflet-routing-machine.css" />

        <!-- Owl Carousel -->
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">

        <!-- DataTables -->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
        <link href="//cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
        <link href="//cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css" rel="stylesheet" />

        <!-- jQuery y plugins -->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/maphilight/1.4.0/jquery.maphilight.min.js"></script>

        <!-- D3.js -->
        <script src="https://d3js.org/d3.v6.min.js"></script>

        <!-- Highcharts -->
        <script src="https://code.highcharts.com/stock/highstock.js"></script>
        <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
        <script src="https://code.highcharts.com/modules/heatmap.js"></script>
        <script src="https://code.highcharts.com/modules/treemap.js"></script>
        <script src="https://code.highcharts.com/modules/treegraph.js"></script>
        <script src="https://code.highcharts.com/highcharts-3d.js"></script>
        <script src="https://code.highcharts.com/modules/wordcloud.js"></script>
        <script src="https://code.highcharts.com/highcharts-more.js"></script>
        <script src="https://code.highcharts.com/modules/exporting.js"></script>
        <script src="https://code.highcharts.com/modules/export-data.js"></script>
        <script src="https://code.highcharts.com/modules/accessibility.js"></script>
        <script src="https://code.highcharts.com/modules/networkgraph.js"></script>
        <script src="https://code.highcharts.com/modules/price-indicator.js"></script>
        <script src="https://code.highcharts.com/modules/pictorial.js"></script>
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
        <script src="https://code.highcharts.com/gantt/modules/gantt.js"></script>

        <!-- HTML2PDF -->
        <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

        <!-- Geovisualizador JS -->
        <script src="~/Geovisualizador/js/qgis2web_expressions.js"></script>
        <script src="~/Geovisualizador/js/leaflet-svg-shape-markers.min.js"></script>
        <script src="~/Geovisualizador/js/Autolinker.min.js"></script>
        <script src="~/Geovisualizador/js/leaflet.rotatedMarker.js"></script>
        <script src="~/Geovisualizador/js/leaflet-hash.js"></script>
        <script src="~/Geovisualizador/js/rbush.min.js"></script>
        <script src="~/Geovisualizador/js/labelgun.min.js"></script>
        <script src="~/Geovisualizador/js/labels.js"></script>
        <script src="~/Geovisualizador/js/L.Control.Layers.Tree.min.js"></script>
        <script src="~/Geovisualizador/js/leaflet.pattern.js"></script>
        <script src="~/Geovisualizador/js/leaflet-control-geocoder.Geocoder.js"></script>
        <script src="~/Geovisualizador/js/leaflet-measure.js"></script>
        <script src="~/Geovisualizador/js/leaflet.markercluster.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-omnivore/0.3.4/leaflet-omnivore.min.js"></script>
        <script src="~/Geovisualizador/dist/leaflet-routing-machine.js"></script>
        <script src="~/Geovisualizador/dist/Control.Geocoder.js"></script>
        <script src="~/Geovisualizador/js/turf.min.js"></script>

        <!-- AmCharts -->
        <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
        <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
        <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>

        <!-- Lightweight Charts -->
        <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
        <script src="~/js/carousel.js"></script>
        <script src="~/js/sections-carousel.js"></script>

        <!-- DOM Observer -->
        <script>
            var observer = new MutationObserver(function (mutations) {
            });
            var observerOptions = {
                childList: true,
                subtree: true
            };
            var targetNode = document.documentElement;
            observer.observe(targetNode, observerOptions);
        </script>

        <!-- Configuración de Mapas -->
        <script src="~/js/configura_mapa.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- Estilos existentes -->
        @RenderSection("Styles", required: false)


        <style>
            /* =====================================================
           VARIABLES CSS SNIER - ELEGANT THEME
           ===================================================== */
            :root {
                /* Colores SNIER */
                --snier-primary: #189c90;
                --snier-accent: #294a95;
                --snier-tertiary: #0891b2;

                /* Grises elegantes */
                --gray-50: #f9fafb;
                --gray-100: #f3f4f6;
                --gray-200: #e5e7eb;
                --gray-300: #d1d5db;
                --gray-400: #9ca3af;
                --gray-500: #6b7280;
                --gray-600: #4b5563;
                --gray-700: #374151;
                --gray-800: #1f2937;
                --gray-900: #111827;

                /* Colores adicionales */
                --white: #ffffff;
                --danger: #dc2626;
                --warning: #f59e0b;
                --success: #10b981;
                --info: #0ea5e9;

                /* Layout variables */
                --sidebar-width: 280px;
                --header-height: 70px;
                --footer-height: 60px;

                /* Tipografía SNIER */
                --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                --font-family-display: 'Space Grotesk', var(--font-family);
                --font-size-xs: 0.75rem;
                --font-size-sm: 0.875rem;
                --font-size-base: 1rem;
                --font-size-lg: 1.125rem;
                --font-size-xl: 1.25rem;
                --font-size-2xl: 1.5rem;
                --font-size-3xl: 1.875rem;
                --font-weight-light: 300;
                --font-weight-normal: 400;
                --font-weight-medium: 500;
                --font-weight-semibold: 600;
                --font-weight-bold: 700;
                --font-weight-extrabold: 800;

                /* Espaciado y efectos */
                --border-radius: 0.75rem;
                --border-radius-lg: 1rem;
                --border-radius-xl: 1.5rem;
                --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.1);
                --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.1);
                --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.15);
                --shadow-strong: 0 25px 50px rgba(0, 0, 0, 0.25);
                --transition: all 0.2s ease;
                --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);

                /* Gradientes SNIER */
                --gradient-snier: linear-gradient(135deg, var(--snier-primary) 0%, var(--snier-accent) 100%);
                --gradient-snier-reverse: linear-gradient(135deg, var(--snier-accent) 0%, var(--snier-primary) 100%);
                --gradient-ocean: linear-gradient(135deg, #ffffff 0%, #b1aeb4 100%);
                --gradient-sunset: linear-gradient(135deg, #dad9db 0%, #ffffff 100%);
            }

            /* =====================================================
           BASE STYLES - SNIER THEME
           ===================================================== */
            * {
                box-sizing: border-box;
            }

            body {
                font-family: var(--font-family);
                font-size: var(--font-size-base);
                font-weight: var(--font-weight-normal);
                line-height: 1.6;
                color: var(--gray-800);
                @* background: var(--gradient-ocean); *@
                background: rgba(255, 255, 255, 0.1);
                background:transparent;
                padding-top: var(--header-height);
                overflow-x: hidden;
                min-height: 100vh;
            }

            /* =====================================================
           HEADER - ELEGANT SNIER DESIGN
           ===================================================== */
            .header-custom {
                height: var(--header-height);
                background: #022336;
                backdrop-filter: blur(20px);
                box-shadow: var(--shadow-soft);
                z-index: 1050;
                border-bottom: 1px solid rgba(30, 126, 140, 0.1);
            }

            .navbar-brand {
                font-family: var(--font-family-display);
                font-weight: var(--font-weight-bold);
                color: var(--snier-primary) !important;
                font-size: var(--font-size-xl);
                text-decoration: none;
                transition: var(--transition-smooth);
            }

            .navbar-brand:hover {
                color: var(--snier-accent) !important;
                transform: translateY(-1px);
            }

            .navbar-brand img {
                transition: var(--transition-smooth);
            }

            .navbar-brand:hover img {
                transform: scale(1.05);
            }

            /* =====================================================
           SIDEBAR - ELEGANT GLASS MORPHISM
           ===================================================== */
            .sidebar-desktop {
                width: var(--sidebar-width);
                background: rgba(255, 255, 255, 0.4);
                backdrop-filter: blur(20px);
                box-shadow: var(--shadow-medium);
                transition: var(--transition-smooth);
                z-index: 1030;
                top: var(--header-height);
                height: calc(100vh - var(--header-height) - var(--footer-height));
                left: 0;
                bottom: var(--footer-height);
                overflow-y: auto;
                padding-bottom: var(--footer-height);
                border-right: 1px solid rgba(255, 255, 255, 0.2);
            }

            .main-content {
                transition: var(--transition-smooth);
                min-height: calc(100vh - var(--header-height) - var(--footer-height));
                padding-bottom: var(--footer-height);
                @* background: rgba(255, 255, 255, 0.1); *@
            }

            .footer-custom {
                height: var(--footer-height);
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                z-index: 1040;
                border-top: 1px solid rgba(30, 126, 140, 0.1);
            }

            /* Estados del sidebar */
            body.sidebar-collapsed .sidebar-desktop {
                transform: translateX(-100%);
            }

            body.sidebar-collapsed .main-content {
                margin-left: 0 !important;
            }

            /* Responsive */
            @@media (min-width: 992px) {
                .main-content {
                    margin-left: var(--sidebar-width);
                }
            }

            @@media (max-width: 991.98px) {
                .main-content {
                    margin-left: 0 !important;
                }
            }

            /* =====================================================
           NAVIGATION LINKS - ELEGANT ANIMATIONS
           ===================================================== */
            .nav-link {
                border-radius: var(--border-radius);
                margin: 4px 12px;
                padding: 0.875rem 1.25rem !important;
                transition: var(--transition-smooth);
                color: var(--gray-700) !important;
                font-weight: var(--font-weight-medium);
                position: relative;
                overflow: hidden;
                background: transparent;
                border: 1px solid transparent;
            }

            .nav-link::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(30, 126, 140, 0.1), transparent);
                transition: left 0.6s ease;
            }

            .nav-link:hover {
                background: rgba(255, 255, 255, 0.8) !important;
                transform: translateX(8px) translateY(-2px);
                color: var(--snier-primary) !important;
                border-color: rgba(30, 126, 140, 0.3);
                box-shadow: var(--shadow-soft);
            }

            .nav-link:hover::before {
                left: 100%;
            }

            .nav-link.active {
                background: var(--gradient-snier) !important;
                color: var(--white) !important;
                transform: translateX(8px);
                box-shadow: var(--shadow-medium);
                border-color: var(--snier-accent);
            }

            .nav-link i {
                font-size: 1.1rem;
                margin-right: 0.75rem;
                transition: var(--transition-smooth);
                opacity: 0.8;
            }

            .nav-link:hover i,
            .nav-link.active i {
                opacity: 1;
                transform: scale(1.1);
            }

            /* =====================================================
           SUBMENU STYLES - ELEGANT COLLAPSE
           ===================================================== */
            .submenu-toggle {
                border-radius: var(--border-radius);
                margin: 4px 12px;
                padding: 0.875rem 1.25rem !important;
                transition: var(--transition-smooth);
                color: var(--gray-700) !important;
                font-weight: var(--font-weight-medium);
                position: relative;
                background: transparent;
                border: 1px solid transparent;
            }

            .submenu-toggle:hover {
                background: rgba(255, 255, 255, 0.8) !important;
                color: var(--snier-primary) !important;
                border-color: rgba(30, 126, 140, 0.2);
                text-decoration: none;
            }

            .submenu-toggle.active-section {
                background: var(--gradient-snier-reverse) !important;
                color: var(--white) !important;
                box-shadow: var(--shadow-soft);
            }

            .submenu-arrow {
                transition: var(--transition-smooth);
            }

            .submenu-toggle[aria-expanded="true"] .submenu-arrow {
                transform: rotate(180deg);
            }

            .submenu-link {
                display: block;
                padding: 0.625rem 1rem 0.625rem 3rem;
                color: var(--gray-600) !important;
                border-radius: calc(var(--border-radius) / 2);
                margin: 2px 12px;
                transition: var(--transition-smooth);
                position: relative;
                font-size: var(--font-size-sm);
                background: transparent;
            }

            .submenu-link::before {
                content: '';
                position: absolute;
                left: 2rem;
                top: 50%;
                width: 6px;
                height: 6px;
                border-radius: 50%;
                background: var(--gray-400);
                transform: translateY(-50%);
                transition: var(--transition-smooth);
            }

            .submenu-link:hover {
                background: rgba(255, 255, 255, 0.6) !important;
                color: var(--snier-primary) !important;
                transform: translateX(6px);
                text-decoration: none;
            }

            .submenu-link:hover::before {
                background: var(--snier-primary);
                transform: translateY(-50%) scale(1.5);
            }

            .submenu-link.active {
                background: rgba(30, 126, 140, 0.1) !important;
                color: var(--snier-primary) !important;
                font-weight: var(--font-weight-semibold);
                border-left: 3px solid var(--snier-primary);
            }

            .submenu-link.active::before {
                background: var(--snier-primary);
                transform: translateY(-50%) scale(1.3);
            }

            /* =====================================================
           BUTTONS - SNIER STYLE
           ===================================================== */
            .btn {
                border-radius: var(--border-radius);
                font-weight: var(--font-weight-medium);
                padding: 0.875rem 1.5rem;
                transition: var(--transition-smooth);
                border: none;
                position: relative;
                overflow: hidden;
            }

            .btn-primary {
                background: var(--gradient-snier);
                color: var(--white);
                box-shadow: var(--shadow-subtle);
            }

            .btn-primary:hover {
                background: var(--gradient-snier-reverse);
                transform: translateY(-2px);
                box-shadow: var(--shadow-soft);
            }

            .sidebar-toggle {
                background: var(--gradient-snier) !important;
                border: 1px solid rgba(30, 126, 140, 0.2);
                color: #ffffff
                transition: var(--transition-smooth);
            }

            .sidebar-toggle:hover {
                background: rgba(30, 126, 140, 0.2);
                transform: scale(1.05);
                color: var(--snier-accent);
            }

            /* =====================================================
           DROPDOWNS - ELEGANT GLASS EFFECT
           ===================================================== */
            .dropdown-menu {
                border: none;
                box-shadow: var(--shadow-strong);
                border-radius: var(--border-radius-lg);
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                padding: 0.75rem 0;
            }

            .dropdown-item {
                color: var(--gray-700);
                padding: 0.75rem 1.5rem;
                transition: var(--transition-smooth);
                border-radius: 0;
            }

            .dropdown-item:hover {
                background: rgba(30, 126, 140, 0.1);
                color: var(--snier-primary);
                transform: translateX(4px);
            }

            .dropdown-item.text-danger:hover {
                background: rgba(220, 38, 38, 0.1);
                color: var(--danger);
            }

            /* =====================================================
           OFFCANVAS - MOBILE SIDEBAR
           ===================================================== */
            .offcanvas-custom {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
            }

            /* =====================================================
           SCROLLBAR PERSONALIZADO
           ===================================================== */
            .custom-scroll {
                scrollbar-width: thin;
                scrollbar-color: rgba(30, 126, 140, 0.3) transparent;
            }

            .custom-scroll::-webkit-scrollbar {
                width: 8px;
            }

            .custom-scroll::-webkit-scrollbar-thumb {
                background: rgba(30, 126, 140, 0.3);
                border-radius: 4px;
                transition: var(--transition);
            }

            .custom-scroll::-webkit-scrollbar-track {
                background: transparent;
            }

            .custom-scroll::-webkit-scrollbar-thumb:hover {
                background: rgba(30, 126, 140, 0.5);
            }

            /* =====================================================
           FORM ELEMENTS - SNIER STYLE
           ===================================================== */
            .form-control {
                border-radius: var(--border-radius);
                border: 1px solid var(--gray-300);
                transition: var(--transition-smooth);
                background: rgba(255, 255, 255, 0.9);
            }

            .form-control:focus {
                border-color: var(--snier-primary);
                box-shadow: 0 0 0 3px rgba(30, 126, 140, 0.1);
                background: var(--white);
            }

            /* =====================================================
           ANIMATED PARTICLES BACKGROUND
           ===================================================== */
            body::before {
                @* content: ''; *@
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background:
                    radial-gradient(circle at 20% 50%, rgba(30, 126, 140, 0.1) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(22, 163, 74, 0.1) 0%, transparent 50%),
                    radial-gradient(circle at 40% 80%, rgba(30, 126, 140, 0.1) 0%, transparent 50%);
                animation: particleFloat 20s ease-in-out infinite;
                z-index: -1;
                pointer-events: none;
            }

            @@keyframes particleFloat {

                0%,
                100% {
                    transform: translate(0, 0) rotate(0deg);
                    opacity: 0.3;
                }

                33% {
                    transform: translate(30px, -30px) rotate(120deg);
                    opacity: 0.5;
                }

                66% {
                    transform: translate(-20px, 20px) rotate(240deg);
                    opacity: 0.4;
                }
            }

            /* =====================================================
           SECTION HEADERS - ELEGANT TYPOGRAPHY
           ===================================================== */
            .section-header {
                font-family: var(--font-family-display);
                font-weight: var(--font-weight-bold);
                color: var(--snier-primary);
                text-transform: uppercase;
                letter-spacing: 0.05em;
                font-size: var(--font-size-xs);
                opacity: 0.8;
                margin-bottom: 1rem;
            }

            /* =====================================================
           RESPONSIVE DESIGN
           ===================================================== */
            @@media (max-height: 600px) and (orientation: landscape) {
                .main-container {
                    align-items: flex-start;
                    padding-top: 1rem;
                }

                .sidebar-desktop {
                    padding-top: 1rem;
                }
            }

            /* =====================================================
           DARK MODE SUPPORT
           ===================================================== */
            @@media (prefers-color-scheme: dark) {
                :root {
                    --gray-50: #111827;
                    --gray-100: #1f2937;
                    --gray-200: #374151;
                }
            }

            /* =====================================================
           LINK ANIMATIONS - CALLING ATTENTION
           ===================================================== */
            .snier-link {
                color: #9f2241;
                text-decoration: none;
                position: relative;
                transition: var(--transition-smooth);
                animation: linkPulse 3s ease-in-out infinite;
            }

            .snier-link:hover {
                color: var(--gray-800);
                text-decoration: none;
                background: rgba(255, 255, 255, 0.95);
                padding: 0.5rem 1rem;
                border-radius: var(--border-radius);
                box-shadow: var(--shadow-soft);
            }

            @@keyframes linkPulse {

                0%,
                100% {
                    color: #9f2241;
                    text-shadow: 0 0 8px rgba(159, 34, 65, 0.6);
                }

                50% {
                    color: var(--snier-primary);
                    text-shadow: 0 0 12px rgba(30, 126, 140, 0.8);
                }
            }

            /* Breadcrumb styles */
.breadcrumb {
    background: transparent;
    padding: 0.5rem 1rem;
    margin-bottom: 1rem;
    border-radius: var(--border-radius);
    font-size: 1rem;
    font-family: var(--font-family-display, 'Space Grotesk', sans-serif);
    box-shadow: none;
}

.breadcrumb-item {
    color: var(--snier-accent, #294a95);
    font-weight: 500;
    letter-spacing: 0.02em;
}

.breadcrumb-item + .breadcrumb-item::before {
    color: var(--snier-primary, #18729c);
    font-size: 1.1em;
    vertical-align: middle;
}

.breadcrumb-item.active {
    color: var(--snier-primary, #189c90);
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(24,156,144,0.08);
}

.breadcrumb a {
    color: var(--snier-accent, #294a95);
    text-decoration: none;
    transition: color 0.2s;
}

.breadcrumb a:hover {
    color: var(--snier-primary, #189c90);
    text-decoration: underline;
}
        </style>
</head>

<body>
    <!-- Header -->
    <header class="header-custom navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container-fluid px-3">
            <!-- Botón toggle -->
            <button id="sidebarToggle" class="btn sidebar-toggle me-3" type="button">
                <i class="bi bi-list"></i>
            </button>

            <!-- Logo/Marca SNIER -->
            <a class="navbar-brand d-flex align-items-center" href="@Url.Action("Index", "Home")">
                <span class="bg-whitep-2 me-2" >
                    <img src="~/img/lc6.png" alt="Logo SNIER" style="height:64px;width:auto;" />
                </span>
                @* <span class="fw-bold d-none d-md-inline">SNIER</span> *@
            </a>

            <!-- Contenido derecho del header -->
            <div class="d-flex align-items-center ms-auto">
                <!-- Buscador -->
                <form class="d-none d-md-flex me-3" role="search">
                    <div class="input-group input-group-sm">
                        <input class="form-control" type="search" placeholder="Buscar..." aria-label="Buscar">
                        <button class="btn btn-primary" type="submit">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </form>

                <!-- Notificaciones -->
@if (perfilUsuario.Rol != "0")
{
    <div class="app-utility-item app-notifications-dropdown dropdown me-3">
        <a class="btn btn-primary position-relative dropdown-toggle no-toggle-arrow"
           id="notifications-dropdown-toggle"
           data-bs-toggle="dropdown"
           href="#"
           role="button"
           aria-expanded="false"
           title="Notificaciones">

            <!-- Ícono blanco -->
            <i class="bi bi-bell text-white"></i>

            <!-- Badge dinámico -->
            <span class="icon-badge hidden" id="notification-count">0</span>
        </a>

        <ul class="dropdown-menu dropdown-menu-end shadow-sm" aria-labelledby="notifications-dropdown-toggle">
            <li>
                <h6 class="dropdown-header">Avisos Importantes</h6>
            </li>

            <li id="notifications-list">
                <a class="dropdown-item" href="#">
                    <i class="bi bi-info-circle text-info me-2"></i>Ejemplo de notificación
                </a>
            </li>

            <li><hr class="dropdown-divider" /></li>

            <li>
                <a class="dropdown-item text-center small snier-link"
                   href="@Url.Action("AllNotifications", "Usuarios", new { userId = ViewData["IDUsuario"] })">
                    Ver todas las notificaciones
                </a>
            </li>
        </ul>
    </div>
}


                <!-- Fin Notificaciones -->

                <!-- Perfil de usuario -->
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="userDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle me-2"></i>
                        <span class="d-none d-md-inline">@ViewData["NombreUsuario"]</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li>
                            <h6 class="dropdown-header">@ViewData["NombreUsuario"]</h6>
                        </li>
                        <li><span class="dropdown-item-text small text-muted">@ViewData["RolUsuario"]</span></li>
                        <li><span class="dropdown-item-text small text-muted">@ViewData["Unidad_de_Adscripcion"]</span>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item"
                                href="@Url.Action("ModeloCuentaCompuesto", "Usuarios", new { id = ViewData["IDUsuario"] })"><i
                                    class="bi bi-person me-2"></i>Mi Perfil</a></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Configuración</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item text-danger" asp-area="" asp-controller="Acceso"
                                asp-action="CerrarSesion"><i class="bi bi-box-arrow-right me-2"></i>Salir</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar para móviles (Offcanvas) -->
    <div class="offcanvas offcanvas-start offcanvas-custom d-lg-none" tabindex="-1" id="sidebarMobile">
        <div class="offcanvas-header border-bottom">
            <h5 class="offcanvas-title text-dark">
                <i class="bi bi-speedometer2 me-2"></i>Menú Principal
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-0 custom-scroll">
            <nav class="nav flex-column py-3">
                <div class="px-3 pb-2">
                    <small class="section-header">Navegación</small>
                </div>

                <a class="nav-link @(currentController == "Home" ? "active" : "")" href="@Url.Action("Index", "Home")">
                    <i class="bi bi-house me-3"></i>Inicio
                </a>
                <a class="nav-link @(currentController == "Dashboard" ? "active" : "")" href="#">
                    <i class="bi bi-bar-chart me-3"></i>Dashboard
                </a>
                <a class="nav-link @(currentController == "Reportes" ? "active" : "")" href="#">
                    <i class="bi bi-file-earmark-text me-3"></i>Reportes
                </a>
                <a class="nav-link @(currentController == "Mapa" ? "active" : "")" href="#">
                    <i class="bi bi-geo-alt me-3"></i>Geovisualizador
                </a>
                <a class="nav-link @(currentController == "Analisis" ? "active" : "")" href="#">
                    <i class="bi bi-graph-up me-3"></i>Análisis
                </a>

                @if (seccionesUsuario != null && seccionesUsuario.Any())
                {
                    <hr class="my-3 mx-3 border-secondary">
                    <div class="px-3 pb-2">
                        <small class="section-header">Secciones Especializadas</small>
                    </div>
                    <ul class="list-unstyled" id="menu-accordion-mobile">
                        @foreach (var seccion in seccionesUsuario)
                        {
                            var modulosVisibles = seccion.Modulos
                            .Where(m => string.IsNullOrEmpty(m.Roles) || m.Roles.Split(',').Contains(perfilUsuario.Rol))
                            .ToList();
                            var isActiveSection = modulosVisibles.Any(m => currentController == m.Controller && currentAction ==
                            m.Action);
                            var submenuId = "submenu-mobile-" + seccion.Titulo.GetHashCode();
                            var sectionId = seccion.Titulo.Replace(" ", "-").ToLowerInvariant(); // <-- Asegura el mismo formato

                            if (modulosVisibles.Any())
                            {
                                <li class="nav-item has-submenu">
                                    <a class="nav-link submenu-toggle d-flex align-items-center justify-content-between @(isActiveSection ? "active-section" : "collapsed")"
                                        href="#" data-bs-toggle="collapse" data-bs-target="#@submenuId"
                                        aria-expanded="@(isActiveSection.ToString().ToLower())" aria-controls="@submenuId"
                                        data-section="@sectionId"> <!-- <-- AQUÍ -->
                                        <span class="d-flex align-items-center">
                                            <span class="nav-icon me-2">@seccion.Titulo.Substring(0, 2)</span>
                                            <span class="nav-link-text">@seccion.Titulo.Substring(2)</span>
                                        </span>
                                        <span class="submenu-arrow"><i class="bi bi-chevron-down"></i></span>
                                    </a>
                                    <div id="@submenuId" class="collapse submenu @(isActiveSection ? "show" : "")"
                                        data-bs-parent="#menu-accordion-mobile">
                                        <ul class="submenu-list list-unstyled">
                                            @foreach (var mod in modulosVisibles)
                                            {
                                                <li class="submenu-item">
                                                    <a class="submenu-link @(currentAction == mod.Action && currentController == mod.Controller ? "active" : "")"
                                                        href="@Url.Action(mod.Action, mod.Controller)">
                                                        @mod.Title
                                                    </a>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                </li>
                            }
                        }
                    </ul>
                }

                <hr class="my-3 mx-3 border-secondary">
                <div class="px-3 pb-2">
                    <small class="section-header">Sistema</small>
                </div>
                <a class="nav-link" href="#">
                    <i class="bi bi-gear me-3"></i>Configuración
                </a>
                <a class="nav-link snier-link" href="#">
                    <i class="bi bi-question-circle me-3"></i>Ayuda
                </a>
            </nav>
        </div>
    </div>

    <!-- Sidebar para escritorio -->
    <aside id="sidebarDesktop"
        class="sidebar-desktop position-fixed top-0 start-0 d-none d-lg-block vh-100 custom-scroll"
        style="padding-top: var(--header-height);">
        <div class="p-0 h-100">
            <nav class="nav flex-column py-4">
                <div class="px-3 pb-3">
                    <small class="section-header">Navegación Principal</small>
                </div>

                <a class="nav-link @(currentController == "Home" ? "active" : "")" href="@Url.Action("Index", "Home")">
                    <i class="bi bi-house"></i>Inicio
                </a>
                <a class="nav-link @(currentController == "Dashboard" ? "active" : "")" href="#">
                    <i class="bi bi-bar-chart"></i>Dashboard
                </a>
                <a class="nav-link @(currentController == "Reportes" ? "active" : "")" href="#">
                    <i class="bi bi-file-earmark-text"></i>Reportes
                </a>
                <a class="nav-link @(currentController == "Mapa" ? "active" : "")" href="#">
                    <i class="bi bi-geo-alt"></i>Geovisualizador
                </a>
                <a class="nav-link @(currentController == "Analisis" ? "active" : "")" href="#">
                    <i class="bi bi-graph-up"></i>Análisis
                </a>
                @foreach (var seccion in seccionesUsuario)
                {
                    var modulosVisibles = seccion.Modulos
                    .Where(m => string.IsNullOrEmpty(m.Roles) || m.Roles.Split(',').Contains(perfilUsuario.Rol))
                    .ToList();
                    var isActiveSection = modulosVisibles.Any(m => currentController == m.Controller && currentAction ==
                    m.Action);
                    var submenuId = "submenu-mobile-" + seccion.Titulo.GetHashCode();
                    var sectionId = seccion.Titulo.Replace(" ", "-").ToLowerInvariant(); // <-- Asegura el mismo formato

                    if (modulosVisibles.Any())
                    {
                        <li class="nav-item has-submenu">
                            <a class="nav-link submenu-toggle d-flex align-items-center justify-content-between @(isActiveSection ? "active-section" : "collapsed")"
                                href="#" data-bs-toggle="collapse" data-bs-target="#@submenuId"
                                aria-expanded="@(isActiveSection.ToString().ToLower())" aria-controls="@submenuId"
                                data-section="@sectionId"> <!-- <-- AQUÍ -->
                                <span class="d-flex align-items-center">
                                    <span class="nav-icon me-2">@seccion.Titulo.Substring(0, 2)</span>
                                    <span class="nav-link-text">@seccion.Titulo.Substring(2)</span>
                                </span>
                                <span class="submenu-arrow"><i class="bi bi-chevron-down"></i></span>
                            </a>
                            <div id="@submenuId" class="collapse submenu @(isActiveSection ? "show" : "")"
                                data-bs-parent="#menu-accordion-mobile">
                                <ul class="submenu-list list-unstyled">
                                    @foreach (var mod in modulosVisibles)
                                    {
                                        <li class="submenu-item">
                                            <a class="submenu-link @(currentAction == mod.Action && currentController == mod.Controller ? "active" : "")"
                                                href="@Url.Action(mod.Action, mod.Controller)">
                                                @mod.Title
                                            </a>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </li>
                    }
                }

                <div class="px-3 pb-3">
                    <small class="section-header">Sistema</small>
                </div>
                <a class="nav-link" href="#">
                    <i class="bi bi-gear"></i>Configuración
                </a>
                <a class="nav-link snier-link" href="#">
                    <i class="bi bi-question-circle"></i>Ayuda
                </a>
            </nav>
        </div>
    </aside>

    <!-- Contenido principal -->
    <main class="main-content p-0">

        <div id="page-preloader" style="display:flex;">
            <div class="spinner"></div>
            <img src="~/img/lc6.png" alt="Logo de la empresa" class="preloader-logo">
            <div class="loading-text">Cargando la página, por favor espere<span id="page-dots">...</span></div>
        </div>
        @*  <!-- Preloader para solicitudes AJAX --> *@
        <div id="ajax-preloader" style="display:none;">
            <div class="spinner"></div>
            <img src="~/img/lc6.png" alt="Logo de la empresa" class="preloader-logo">
            <div class="loading-text">Cargando los datos, por favor espere<span id="ajax-dots">...</span></div>
        </div>

        @RenderBody()
    </main>

    <!-- Footer --> 

    <footer class="footer-custom position-fixed bottom-0 w-100 d-flex align-items-center justify-content-center" style="background:#022336;">   
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 small text-light small mb-1" >
                        &copy; 2025 SNIER - Sistema Nacional de Información Energética
                        @await Component.InvokeAsync("Visitas")
                    </p>

                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0 small text-muted">
                        Secretaría de Energía - Gobierno de México
                    </p>
                </div>
                 @* <div class="cinta"></div> *@
            </div>
        </div>
    </footer>

    @* <!-- Modal de advertencia de expiración de sesión --> *@
    <div class="modal fade" id="sessionExpireModal" tabindex="-1" role="dialog"
        aria-labelledby="sessionExpireModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sessionExpireModalLabel">Advertencia de Expiración de Sesión</h5>
                </div>
                <div class="modal-body">
                    Su sesión está a punto de expirar. ¿Desea continuar trabajando o cerrar la sesión?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="btnCerrarSesion">Cerrar Sesión</button>
                    <button type="button" class="btn btn-primary" id="btnContinuarSesion">Continuar Sesión</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        $(document).ready(function () {
            // Definir las variables utilizando Razor
            // Definir las variables utilizando Razor
            var userId = "@ViewData["IDUsuario"]";
            var userName = "@ViewData["NombreUsuario"]";
            var pageName = "@ViewData["Title"]";
            var controllerName = "@ViewContext.RouteData.Values["controller"]";
            var actionName = "@ViewContext.RouteData.Values["action"]";
            var additionalData = "@(ViewData["NombreUsuario"] + " - " + ViewData["Unidad_de_Adscripcion"])";


            // Imprimir los datos en la consola antes de enviarlos
            console.log({
                userId: userId,
                userName: userName,
                pageName: pageName,
                controllerName: controllerName,
                actionName: actionName,
                additionalData: additionalData
            });

            // Verificar que las variables no estén vacías
            if (userId && userId !== "N/A") {
                registrarActividad("Sin Dato", "Sin Dato", "Sin Dato", "Sin Dato");  // Registrar la acción de carga de página
            } else {
                console.log('No se registró la acción debido a valores faltantes o usuario no autenticado.');
            }

            // Función de debounce para evitar múltiples registros en base a la escritura del usuario
            function debounce(func, delay) {
                let debounceTimer;
                return function () {
                    const context = this;
                    const args = arguments;
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => func.apply(context, args), delay);
                };
            }

            // Función para registrar actividades (acciones e interacciones)
            function registrarActividad(tipo, elemento, idElemento, valor) {
                console.log({
                    userId: userId,
                    userName: userName,
                    pageName: pageName,
                    controllerName: controllerName,
                    actionName: actionName,
                    tipo: tipo,
                    elemento: elemento,
                    idElemento: idElemento,
                    valor: valor,
                    additionalData: additionalData
                });

                $.ajax({
                    url: '/Bitacora/RegistrarActividad',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        userId: userId,
                        userName: userName,
                        pageName: pageName,
                        controllerName: controllerName,
                        actionName: actionName,
                        tipo: tipo,
                        elemento: elemento,
                        idElemento: idElemento,
                        valor: valor,
                        additionalData: additionalData
                    }),
                    success: function (response) {
                        console.log('Actividad registrada exitosamente:', response);
                    },
                    error: function (xhr, status, error) {
                        console.log('Error al registrar la actividad:', error);
                    }
                });
            }

            // Usar delegación de eventos en un contenedor que siempre esté en el DOM
            $(document).on('click', 'table button', function () {
                registrarActividad('click', 'button', this.id, $(this).text());
            });

            $(document).on('blur', 'table input[type="text"]', debounce(function () {
                registrarActividad('input', 'textbox', this.id, $(this).val());
            }, 1000));

            $(document).on('change', 'table input[type="checkbox"]', function () {
                registrarActividad('click', 'checkbox', this.id, this.checked ? 'checked' : 'unchecked');
            });

            $(document).on('change', 'table input[type="radio"]', function () {
                registrarActividad('click', 'radio', this.id, $(this).val());
            });

            $(document).on('change', 'table select', function () {
                registrarActividad('change', 'dropdown', this.id, $(this).val());
            });

            // Capturar clics en todos los botones fuera de la tabla
            $(document).on('click', 'button', function () {
                if (!$(this).closest('table').length) {
                    registrarActividad('click', 'button', this.id, $(this).text());
                }
            });

            // Capturar cuando el usuario deja el campo de texto (blur) con retraso de 1 segundo
            $(document).on('blur', 'input[type="text"]', function () {
                if (!$(this).closest('table').length) {
                    var inputElement = this;
                    setTimeout(function () {
                        registrarActividad('input', 'textbox', inputElement.id, $(inputElement).val());
                    }, 2000);
                }
            });

            // Capturar cambios en checkboxes fuera de la tabla
            $(document).on('change', 'input[type="checkbox"]', function () {
                if (!$(this).closest('table').length) {
                    registrarActividad('click', 'checkbox', this.id, this.checked ? 'checked' : 'unchecked');
                }
            });

            // Capturar cambios en radio buttons fuera de la tabla
            $(document).on('change', 'input[type="radio"]', function () {
                if (!$(this).closest('table').length) {
                    registrarActividad('click', 'radio', this.id, $(this).val());
                }
            });

            // Capturar selección en dropdowns fuera de la tabla
            $(document).on('change', 'select', function () {
                if (!$(this).closest('table').length) {
                    registrarActividad('change', 'dropdown', this.id, $(this).val());
                }
            });


        });
    </script>



    <!-- Tablas -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener referencias a elementos
            const tableContainer = document.querySelector('.table-container');
            const table = document.querySelector('.table');

            // Verificar que existan los elementos necesarios
            if (table && tableContainer) {
                // Manejar evento de scroll
                tableContainer.addEventListener('scroll', function () {
                    // Obtener elementos a fijar
                    const ths = table.querySelectorAll('thead th');
                    const tds = table.querySelectorAll('tbody td:first-child');
                    const thFirstColumn = table.querySelector('thead th:first-child');

                    // Aplicar transformaciones
                    // 1. Fijar encabezados
                    ths.forEach(th => {
                        th.style.transform = `translateY(${tableContainer.scrollTop}px)`;
                    });

                    // 2. Fijar primera columna
                    tds.forEach(td => {
                        td.style.transform = `translateX(${tableContainer.scrollLeft}px)`;
                    });

                    // 3. Fijar esquina superior izquierda
                    if (thFirstColumn) {
                        thFirstColumn.style.transform = `translate(${tableContainer.scrollLeft}px, ${tableContainer.scrollTop}px)`;
                    }
                });
            }
        });
    </script>

    @*Manda cada min un toque ala BD *@
    <script>
        $(document).ready(function () {

            // Inicializar el modal con opciones para evitar el cierre al hacer clic fuera o con la tecla Esc
            $('#sessionExpireModal').modal({
                backdrop: 'static', // No permitir cerrar el modal al hacer clic fuera de él
                keyboard: false,    // No permitir cerrar el modal con la tecla Esc
                show: false         // No mostrar automáticamente al cargar la página
            });

            // Función para manejar el Heartbeat
            setInterval(function () {
                $.ajax({
                    url: '/Acceso/Heartbeat',
                    method: 'POST',
                    success: function (data) {
                        if (data.expiracionCercana) {
                            // Mostrar modal de advertencia
                            $('#sessionExpireModalLabel').text('Advertencia de Expiración de Sesión');
                            $('#sessionExpireModal .modal-body').text('Su sesión está a punto de expirar. ¿Desea continuar trabajando o cerrar la sesión?');
                            $('#btnCerrarSesion').show();
                            $('#btnContinuarSesion').show();
                            $('#sessionExpireModal').modal('show');
                        }
                    },
                    error: function (xhr, status, error) {
                        if (xhr.status === 401) {
                            // Mostrar modal de sesión expirada
                            $('#sessionExpireModalLabel').text('Sesión Expirada');
                            $('#sessionExpireModal .modal-body').text('Su sesión ha expirado. Será redirigido a la página de inicio de sesión.');
                            $('#btnCerrarSesion').hide(); // Ocultar botón innecesario
                            $('#btnContinuarSesion').text('Ir a Login').off('click').on('click', function () {
                                window.location.href = '/Acceso/Login';
                            });
                            $('#sessionExpireModal').modal('show');
                        } else {
                            console.error("Error en la solicitud Heartbeat:", error);
                        }
                    }
                });
            }, 60000); // Cada 60 segundos

            // Cerrar sesión
            $('#btnCerrarSesion').on('click', function () {
                window.location.href = '/Acceso/SesionExpirada';
            });

            // Continuar sesión
            $('#btnContinuarSesion').on('click', function () {
                $.ajax({
                    url: '/Acceso/ActualizarInicioSesion',
                    method: 'POST',
                    success: function () {
                        $('#sessionExpireModal').modal('hide');
                        // Se ha actualizado la sesión, el usuario puede continuar trabajando
                    },
                    error: function (xhr, status, error) {
                        console.error("Error al actualizar la sesión:", error);
                    }
                });
            });
        });

    </script>
    <script src="~/js/validacion-formulario.js"></script>
    <!-- JavaScript -->
    @if (perfilUsuario.Rol != "1")
    {
        <script src="~/js/seguridad.js"></script>
    }
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    @* <script src="//code.jquery.com/jquery-3.5.1.js"></script> *@
    <script src="//cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="//cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="//cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script src="~/js/jquery.maphilight.min.js"></script>

    @* <script  src="~/js/jspdf.min.js"></script> *@
    <script src="~/js/printThis.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>




    <!-- Owl Carousel JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>

    <script src="~/js/site.js" asp-append-version="true"></script>
    <!-- Page Specific JS -->
    <script src="~/js/app.js" asp-append-version="true"></script>
    @* html2pdf *@
    @* <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script> *@

    @*Preloader*@
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Mostrar el preloader de carga de página
            document.getElementById('page-preloader').style.display = 'flex';

            // Ocultar el preloader de carga de página cuando la página ha terminado de cargarse
            window.addEventListener('load', function () {
                document.getElementById('page-preloader').style.display = 'none';
            });

            // Animar los puntos de carga para el preloader de página
            var pageDots = 0;
            setInterval(function () {
                var pageDotsElement = document.getElementById('page-dots');
                if (pageDotsElement) {
                    pageDotsElement.innerHTML = '.'.repeat(pageDots);
                    pageDots = (pageDots + 1) % 4; // Ciclo de 0 a 3 puntos
                }
            }, 500);

            // Mostrar el preloader al enviar el formulario
            $('form').on('submit', function (e) {
                var form = $(this);
                if (form.attr('id') === 'form-upload-files' || form.valid()) {
                    $('#page-preloader').show();
                }
            });

            // Ocultar el preloader si hay errores de validación en el servidor
            var validationSummary = document.querySelector('.validation-summary-errors');
            if (validationSummary && validationSummary.innerHTML.trim().length > 0) {
                document.getElementById('page-preloader').style.display = 'none';
                alert('Por favor, complete todos los campos obligatorios.');
            }
        });

        // Preloader para solicitudes AJAX
        $(document).ajaxStart(function () {
            $("#ajax-preloader").show();
        }).ajaxStop(function () {
            $("#ajax-preloader").hide();
        });

        // Animar los puntos de carga para el preloader de AJAX
        var ajaxDots = 0;
        setInterval(function () {
            var ajaxDotsElement = document.getElementById('ajax-dots');
            if (ajaxDotsElement) {
                ajaxDotsElement.innerHTML = '.'.repeat(ajaxDots);
                ajaxDots = (ajaxDots + 1) % 4; // Ciclo de 0 a 3 puntos
            }
        }, 500);

    </script>

    <!-- Sección de notificaciones -->
    <script>
        $(document).ready(function () {
            function loadNotifications() {
                $.ajax({
                    url: '@Url.Action("GetNotifications", "Usuarios")',
                    type: 'GET',
                    data: { userId: '@ViewData["IDUsuario"]' },
                    success: function (data) {
                        console.log("Tabla de notificaciones: ", data);
                        var notificationCount = data.totalUnreadCount;
                        var notifications = data.notifications;
                        var notificationBadge = $('#notification-count');

                        if (notificationCount > 0) {
                            notificationBadge.text(notificationCount);
                            notificationBadge.removeClass('hidden');
                        } else {
                            notificationBadge.addClass('hidden');
                        }

                        var notificationsList = $('#notifications-list');
                        notificationsList.empty();

                        notifications.forEach(function (notification) {
                            var maxLength = 100;
                            var shortMessage = notification.mensaje.length > maxLength
                                ? notification.mensaje.substring(0, maxLength) + '...'
                                : notification.mensaje;

                            var notificationItem = `
                                <div class="item p-3" data-id="${notification.id}">
                                    <div class="row gx-2 justify-content-between align-items-center">
                                        <div class="col-auto">
                                            <img class="profile-image" src="/img/notificaciones.png" alt="">
                                        </div>
                                        <div class="col">
                                            <div class="info">
                                                <div class="title"><strong>${notification.titulo_Notificacion}</strong></div>
                                                <div class="desc">${shortMessage}</div>
                                                <div class="meta">${notification.timeAgo}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <a class="link-mask" href="@Url.Action("NotificationDetails", "Usuarios")?titulo=${encodeURIComponent(notification.titulo_Notificacion)}&mensaje=${encodeURIComponent(notification.mensaje)}&fecha=${encodeURIComponent(notification.fecha_Notificacion)}&link=${encodeURIComponent(notification.link)}" target="_blank" onclick="markAsRead(${notification.id}, this)"></a>
                                </div>`;
                            notificationsList.append(notificationItem);
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error("Error al cargar las notificaciones:", error);
                    }
                });
            }

            loadNotifications();

            setInterval(loadNotifications, 60000);

            $('#generate-test-notification').on('click', function () {
                $.ajax({
                    url: '@Url.Action("GenerateTestNotification", "Usuarios")',
                    type: 'POST',
                    data: { userId: '@ViewData["IDUsuario"]' },
                    success: function (response) {
                        if (response.success) {
                            loadNotifications();
                            alert("Notificación de prueba generada con éxito.");
                        } else {
                            alert("Error al generar la notificación de prueba.");
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("Error al generar la notificación de prueba:", error);
                    }
                });
            });
        });

        function markAsRead(notificationId, linkElement) {
            $.ajax({
                url: '@Url.Action("MarkNotificationAsRead", "Usuarios")',
                type: 'POST',
                data: { notificationId: notificationId },
                success: function (response) {
                    if (response.success) {
                        var notificationItem = $(linkElement).closest('.item');
                        notificationItem.remove();

                        var notificationBadge = $('#notification-count');
                        var currentCount = parseInt(notificationBadge.text());
                        var newCount = currentCount - 1;

                        if (newCount > 0) {
                            notificationBadge.text(newCount);
                        } else {
                            notificationBadge.addClass('hidden');
                        }

                        loadNotifications();

                        var url = $(linkElement).attr('href');
                        window.open(url, '_blank');
                    } else {
                        console.error("Error al marcar la notificación como leída.");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error al marcar la notificación como leída:", error);
                }
            });
        }
    </script>

    <style>
        /* Esto bloqueará la selección de texto en todo el documento HTML */
        body {
            -webkit-user-select: none;
            /* Safari */
            -moz-user-select: none;
            /* Firefox */
            -ms-user-select: none;
            /* Internet Explorer/Edge */
            user-select: none;
            /* Chrome, Opera y otras versiones de Firefox */
        }
    </style>
    @*Rutas*@
    @await RenderSectionAsync("Scripts", required: false)
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    @section Scripts {
        <script src="~/js/module-help.js"></script>
    }

    <!-- Custom Scripts -->
    <script>
        // Toggle sidebar functionality
        document.addEventListener('DOMContentLoaded', function () {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const body = document.body;
            const sidebarMobile = document.getElementById('sidebarMobile');

            sidebarToggle.addEventListener('click', function () {
                if (window.innerWidth >= 992) {
                    // Desktop: toggle sidebar collapse
                    body.classList.toggle('sidebar-collapsed');
                } else {
                    // Mobile: show offcanvas
                    const offcanvas = new bootstrap.Offcanvas(sidebarMobile);
                    offcanvas.show();
                }
            });

            // Handle responsive changes
            window.addEventListener('resize', function () {
                if (window.innerWidth >= 992) {
                    // Hide mobile sidebar if open
                    const offcanvasInstance = bootstrap.Offcanvas.getInstance(sidebarMobile);
                    if (offcanvasInstance) {
                        offcanvasInstance.hide();
                    }
                }
            });

            // Enhanced navigation animations
            const navLinks = document.querySelectorAll('.nav-link, .submenu-link');
            navLinks.forEach(link => {
                link.addEventListener('mouseenter', function () {
                    this.style.transform = this.classList.contains('active') ?
                        'translateX(8px)' : 'translateX(8px) translateY(-2px)';
                });

                link.addEventListener('mouseleave', function () {
                    this.style.transform = this.classList.contains('active') ?
                        'translateX(8px)' : 'translateX(0)';
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.section-toggle[data-section]').forEach(function (el) {
                el.addEventListener('click', function (e) {
                    var section = this.getAttribute('data-section');
                    if (section) {
                        window.dispatchEvent(new CustomEvent('snier-section-change', { detail: { section } }));
                    }
                });
            });
        });
    </script>


</body>

</html>